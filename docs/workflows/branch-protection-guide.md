# åˆ†æ”¯ä¿æŠ¤è§„åˆ™é…ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æŒ‡å¯¼å¦‚ä½•é…ç½® GitHub åˆ†æ”¯ä¿æŠ¤è§„åˆ™ï¼Œç¡®ä¿æ‰€æœ‰ PR å¿…é¡»é€šè¿‡ CI æ£€æŸ¥åæ‰èƒ½åˆå¹¶åˆ°ä¸»è¦åˆ†æ”¯ã€‚

## ğŸ¯ ä¿æŠ¤ç›®æ ‡

é…ç½®ä»¥ä¸‹åˆ†æ”¯çš„ä¿æŠ¤è§„åˆ™ï¼š
- `main` / `master` - ç”Ÿäº§åˆ†æ”¯
- `develop` - å¼€å‘åˆ†æ”¯

## ğŸ”§ é…ç½®æ­¥éª¤

### 1. è¿›å…¥ä»“åº“è®¾ç½®

1. æ‰“å¼€ GitHub ä»“åº“é¡µé¢
2. ç‚¹å‡» **Settings** (è®¾ç½®)
3. åœ¨å·¦ä¾§èœå•ä¸­æ‰¾åˆ° **Branches** (åˆ†æ”¯)

### 2. æ·»åŠ åˆ†æ”¯ä¿æŠ¤è§„åˆ™

ç‚¹å‡» **Add branch protection rule** (æ·»åŠ åˆ†æ”¯ä¿æŠ¤è§„åˆ™)

### 3. é…ç½®ä¿æŠ¤è§„åˆ™

#### åŸºç¡€é…ç½®

**Branch name pattern** (åˆ†æ”¯åç§°æ¨¡å¼):
```
develop
```

æˆ–è€…åŒæ—¶ä¿æŠ¤å¤šä¸ªåˆ†æ”¯ï¼ˆä½¿ç”¨é€šé…ç¬¦ï¼‰:
```
main
master
develop
```

#### å¿…éœ€çš„æ£€æŸ¥é¡¹

å‹¾é€‰ä»¥ä¸‹é€‰é¡¹ï¼š

âœ… **Require a pull request before merging**
   - è¦æ±‚é€šè¿‡ PR æ‰èƒ½åˆå¹¶
   - æ¨èé…ç½®ï¼š
     - âœ… Require approvals: 1 (è‡³å°‘éœ€è¦ 1 äººå®¡æ‰¹)
     - âœ… Dismiss stale pull request approvals when new commits are pushed (æ–°æäº¤æ—¶å–æ¶ˆæ—§çš„å®¡æ‰¹)

âœ… **Require status checks to pass before merging**
   - è¦æ±‚çŠ¶æ€æ£€æŸ¥é€šè¿‡åæ‰èƒ½åˆå¹¶
   - âœ… Require branches to be up to date before merging (è¦æ±‚åˆ†æ”¯ä¸ºæœ€æ–°)

   **Status checks that are required** (å¿…éœ€é€šè¿‡çš„æ£€æŸ¥):
   - âœ… `ä»£ç è´¨é‡æ£€æŸ¥` (lint-and-format)
   - âœ… `TypeScript ç±»å‹æ£€æŸ¥` (type-check)
   - âœ… `æ„å»ºæ£€æŸ¥` (build)
   - âœ… `å•å…ƒæµ‹è¯•` (test)
   - âœ… `CI æ£€æŸ¥æ±‡æ€»` (ci-summary)

âœ… **Require conversation resolution before merging**
   - è¦æ±‚è§£å†³æ‰€æœ‰å¯¹è¯åæ‰èƒ½åˆå¹¶

âœ… **Do not allow bypassing the above settings**
   - ä¸å…è®¸ç»•è¿‡ä¸Šè¿°è®¾ç½®ï¼ˆåŒ…æ‹¬ç®¡ç†å‘˜ï¼‰

#### å¯é€‰é…ç½®

æ ¹æ®å›¢é˜Ÿéœ€æ±‚é€‰æ‹©ï¼š

â¬œ **Require deployments to succeed before merging**
   - è¦æ±‚éƒ¨ç½²æˆåŠŸåæ‰èƒ½åˆå¹¶ï¼ˆå¦‚æœæœ‰éƒ¨ç½²æµç¨‹ï¼‰

â¬œ **Require signed commits**
   - è¦æ±‚ç­¾åæäº¤ï¼ˆå¢å¼ºå®‰å…¨æ€§ï¼‰

â¬œ **Require linear history**
   - è¦æ±‚çº¿æ€§å†å²è®°å½•ï¼ˆç¦æ­¢åˆå¹¶æäº¤ï¼‰

â¬œ **Include administrators**
   - ç®¡ç†å‘˜ä¹Ÿå¿…é¡»éµå®ˆè§„åˆ™ï¼ˆæ¨èå¯ç”¨ï¼‰

### 4. ä¿å­˜è§„åˆ™

ç‚¹å‡» **Create** æˆ– **Save changes** ä¿å­˜é…ç½®

## ğŸ“Š é…ç½®æ•ˆæœ

é…ç½®å®Œæˆåï¼ŒPR åˆå¹¶æ—¶å°†å¼ºåˆ¶æ£€æŸ¥ï¼š

| æ£€æŸ¥é¡¹ | è¯´æ˜ | è§¦å‘æ¡ä»¶ |
|--------|------|----------|
| ğŸ” **ä»£ç è´¨é‡æ£€æŸ¥** | ESLint + Prettier æ£€æŸ¥ | PR åˆ›å»º/æ›´æ–° |
| ğŸ“ **TypeScript ç±»å‹æ£€æŸ¥** | ç±»å‹ç³»ç»ŸéªŒè¯ | PR åˆ›å»º/æ›´æ–° |
| ğŸ—ï¸ **æ„å»ºæ£€æŸ¥** | æ„å»ºæˆåŠŸéªŒè¯ | PR åˆ›å»º/æ›´æ–° |
| ğŸ§ª **å•å…ƒæµ‹è¯•** | æµ‹è¯•ç”¨ä¾‹é€šè¿‡ | PR åˆ›å»º/æ›´æ–° |
| ğŸ¤– **AI ä»£ç å®¡æŸ¥** | Claude AI ä»£ç å®¡æŸ¥ | PR åˆ›å»º/æ›´æ–° |

## ğŸš« å¸¸è§é˜»å¡åœºæ™¯

### åœºæ™¯ 1: ä»£ç è´¨é‡æ£€æŸ¥å¤±è´¥

**åŸå› **: ESLint æˆ– Prettier æ£€æŸ¥ä¸é€šè¿‡

**è§£å†³**:
```bash
# æœ¬åœ°ä¿®å¤
pnpm run lint        # è‡ªåŠ¨ä¿®å¤ ESLint é—®é¢˜
pnpm run format      # æ ¼å¼åŒ–ä»£ç 

# æäº¤ä¿®å¤
git add .
git commit -m "fix: ä¿®å¤ä»£ç è´¨é‡é—®é¢˜"
git push
```

### åœºæ™¯ 2: TypeScript ç±»å‹é”™è¯¯

**åŸå› **: ç±»å‹æ£€æŸ¥å¤±è´¥

**è§£å†³**:
```bash
# æœ¬åœ°æ£€æŸ¥
pnpm exec tsc --noEmit

# ä¿®å¤ç±»å‹é”™è¯¯åæäº¤
git add .
git commit -m "fix: ä¿®å¤ç±»å‹é”™è¯¯"
git push
```

### åœºæ™¯ 3: æ„å»ºå¤±è´¥

**åŸå› **: ä»£ç æ— æ³•ç¼–è¯‘

**è§£å†³**:
```bash
# æœ¬åœ°æ„å»ºæµ‹è¯•
pnpm run build

# ä¿®å¤æ„å»ºé”™è¯¯åæäº¤
git add .
git commit -m "fix: ä¿®å¤æ„å»ºé”™è¯¯"
git push
```

### åœºæ™¯ 4: å•å…ƒæµ‹è¯•å¤±è´¥

**åŸå› **: æµ‹è¯•ç”¨ä¾‹ä¸é€šè¿‡

**è§£å†³**:
```bash
# æœ¬åœ°è¿è¡Œæµ‹è¯•
pnpm run test

# ä¿®å¤æµ‹è¯•åæäº¤
git add .
git commit -m "fix: ä¿®å¤å•å…ƒæµ‹è¯•"
git push
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æœ¬åœ°é¢„æ£€æŸ¥

åœ¨æäº¤ PR å‰ï¼Œæœ¬åœ°è¿è¡Œæ‰€æœ‰æ£€æŸ¥ï¼š

```bash
# å®Œæ•´çš„æœ¬åœ°æ£€æŸ¥æµç¨‹
pnpm run lint              # ä»£ç è´¨é‡æ£€æŸ¥
pnpm run format            # ä»£ç æ ¼å¼åŒ–
pnpm exec tsc --noEmit     # ç±»å‹æ£€æŸ¥
pnpm run build             # æ„å»ºæ£€æŸ¥
pnpm run test              # å•å…ƒæµ‹è¯•
```

### 2. ä½¿ç”¨ Git Hooks

é¡¹ç›®å·²é…ç½® pre-commit hookï¼Œä¼šåœ¨æäº¤æ—¶è‡ªåŠ¨è¿è¡Œæ£€æŸ¥ï¼š

```bash
# .claude/scripts/check-modified-files.sh
# è‡ªåŠ¨è¿è¡Œ lint å’Œ format
```

### 3. CI ç¼“å­˜ä¼˜åŒ–

CI å·¥ä½œæµå·²é…ç½® pnpm ç¼“å­˜ï¼ŒåŠ å¿«æ£€æŸ¥é€Ÿåº¦ï¼š

```yaml
- name: Cache pnpm dependencies
  uses: actions/cache@v4
  with:
    path: ${{ steps.pnpm-cache.outputs.pnpm_cache_dir }}
    key: ${{ runner.os }}-pnpm-${{ hashFiles('**/pnpm-lock.yaml') }}
```

### 4. å¹¶è¡Œæ£€æŸ¥

CI å·¥ä½œæµä¸­å¤šä¸ªæ£€æŸ¥å¹¶è¡Œè¿è¡Œï¼Œæé«˜æ•ˆç‡ï¼š

```yaml
jobs:
  lint-and-format:    # å¹¶è¡Œè¿è¡Œ
  type-check:         # å¹¶è¡Œè¿è¡Œ
  build:              # å¹¶è¡Œè¿è¡Œ
  test:               # å¹¶è¡Œè¿è¡Œ
  ci-summary:         # ç­‰å¾…ä»¥ä¸Šå…¨éƒ¨å®Œæˆ
```

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ä¸è¦ç»•è¿‡æ£€æŸ¥**: å³ä½¿æ˜¯ç®¡ç†å‘˜ä¹Ÿåº”è¯¥é€šè¿‡æ­£å¸¸æµç¨‹
2. **å®¡æŸ¥ AI å»ºè®®**: AI ä»£ç å®¡æŸ¥æä¾›äº†é¢å¤–çš„å®‰å…¨æ£€æŸ¥
3. **å®šæœŸæ›´æ–°ä¾èµ–**: ä½¿ç”¨ `pnpm update` æ›´æ–°ä¾èµ–
4. **ç›‘æ§ CI çŠ¶æ€**: å…³æ³¨ GitHub Actions çš„è¿è¡Œç»“æœ

## ğŸ“ æ•…éšœæ’æŸ¥

### CI æ£€æŸ¥ä¸€ç›´è¿è¡Œ

**å¯èƒ½åŸå› **:
- ä¾èµ–å®‰è£…ç¼“æ…¢
- æµ‹è¯•ç”¨ä¾‹æ­»å¾ªç¯

**è§£å†³**:
1. æŸ¥çœ‹ GitHub Actions æ—¥å¿—
2. æœ¬åœ°å¤ç°é—®é¢˜
3. ä¼˜åŒ–æµ‹è¯•ç”¨ä¾‹æˆ–ä¾èµ–

### æ— æ³•æ‰¾åˆ°çŠ¶æ€æ£€æŸ¥

**å¯èƒ½åŸå› **:
- CI å·¥ä½œæµå°šæœªè¿è¡Œ
- å·¥ä½œæµé…ç½®é”™è¯¯

**è§£å†³**:
1. ç¡®ä¿ `.github/workflows/ci.yml` å·²æäº¤
2. æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡ CI è¿è¡Œ
3. æŸ¥çœ‹ Actions æ ‡ç­¾é¡µç¡®è®¤å·¥ä½œæµçŠ¶æ€

### åˆå¹¶æŒ‰é’®è¢«ç¦ç”¨

**æ­£å¸¸ç°è±¡**: è¿™è¯´æ˜ä¿æŠ¤è§„åˆ™ç”Ÿæ•ˆäº†ï¼

**è§£å†³**: ç­‰å¾…æ‰€æœ‰æ£€æŸ¥é€šè¿‡åï¼ŒæŒ‰é’®ä¼šè‡ªåŠ¨å¯ç”¨

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [GitHub åˆ†æ”¯ä¿æŠ¤è§„åˆ™å®˜æ–¹æ–‡æ¡£](https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches)
- [CI å·¥ä½œæµé…ç½®](../../.github/workflows/ci.yml)
- [AI ä»£ç å®¡æŸ¥é…ç½®](./ai-code-review-guide.md)
- [è‡ªåŠ¨åŒ–ç‰ˆæœ¬ç®¡ç†](./auto-version-changelog.md)

## ğŸ‰ å®Œæˆ

é…ç½®å®Œæˆåï¼Œä½ çš„ä»“åº“å°†å…·æœ‰ä»¥ä¸‹ä¿æŠ¤ï¼š

âœ… ä»£ç è´¨é‡å¼ºåˆ¶ä¿éšœ
âœ… ç±»å‹å®‰å…¨éªŒè¯
âœ… æ„å»ºæˆåŠŸéªŒè¯
âœ… æµ‹è¯•è¦†ç›–éªŒè¯
âœ… AI æ™ºèƒ½å®¡æŸ¥

**ç°åœ¨ä½ å¯ä»¥æ”¾å¿ƒåˆå¹¶ä»£ç äº†ï¼** ğŸš€
