# DuLiDay ä¼ä¸šå¾®ä¿¡æœåŠ¡

åŸºäº NestJS æ„å»ºçš„ä¼ä¸šå¾®ä¿¡æ™ºèƒ½æœåŠ¡ä¸­é—´å±‚ï¼Œé€šè¿‡å¯¹æ¥ä¼ä¸šå¾®ä¿¡æ‰˜ç®¡å¹³å°å’Œ AI Agent æœåŠ¡ï¼Œå®ç°æ™ºèƒ½åŒ–çš„ä¼ä¸šå¾®ä¿¡ç¾¤è¿è¥å’Œæ¶ˆæ¯ç®¡ç†ã€‚

## é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªä¼ä¸šå¾®ä¿¡æœåŠ¡çš„ä¸­é—´å±‚ç³»ç»Ÿï¼Œä¸»è¦è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š

- **æ‰˜ç®¡å¹³å°é›†æˆ**ï¼šå°è£…ä¼ä¸šå¾®ä¿¡æ‰˜ç®¡å¹³å°çš„ APIï¼Œæä¾›ç»Ÿä¸€çš„ä¼ä¸šå¾®ä¿¡æ“ä½œèƒ½åŠ›
- **AI æ™ºèƒ½å›å¤**ï¼šé›†æˆ agent-computer-user AI æœåŠ¡ï¼Œå®ç°æ™ºèƒ½å¯¹è¯å’Œè‡ªåŠ¨å›å¤
- **æ¶ˆæ¯è‡ªåŠ¨åŒ–**ï¼šæ¥æ”¶æ‰˜ç®¡å¹³å°æ¶ˆæ¯å›è°ƒï¼Œè‡ªåŠ¨è°ƒç”¨ AI ç”Ÿæˆå›å¤å¹¶å‘é€
- **çµæ´»å¯æ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒæŒ‰éœ€å¯ç”¨åŠŸèƒ½å’Œè‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘

## æ ¸å¿ƒåŠŸèƒ½

### 1. ä¼ä¸šå¾®ä¿¡æ‰˜ç®¡å¹³å° API å°è£…

é›†æˆä¼ä¸šå¾®ä¿¡æ‰˜ç®¡å¹³å°çš„å®Œæ•´èƒ½åŠ›ï¼š

- **æ¶ˆæ¯ç®¡ç†**ï¼šå‘é€/æ¥æ”¶å•èŠå’Œç¾¤èŠæ¶ˆæ¯ï¼Œæ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ç­‰å¤šç§ç±»å‹
- **ä¼šè¯ç®¡ç†**ï¼šè·å–ä¼šè¯åˆ—è¡¨ã€æŸ¥è¯¢èŠå¤©å†å²
- **è”ç³»äººç®¡ç†**ï¼šæ·»åŠ /åˆ é™¤å¥½å‹ã€æŸ¥è¯¢è”ç³»äººä¿¡æ¯
- **ç¾¤èŠç®¡ç†**ï¼šåˆ›å»ºç¾¤èŠã€é‚€è¯·/ç§»é™¤æˆå‘˜ã€ç¾¤å…¬å‘Šç­‰
- **å®¢æˆ·ç®¡ç†**ï¼šä¼ä¸šå®¢æˆ·ä¿¡æ¯ç®¡ç†
- **æœºå™¨äººç®¡ç†**ï¼šæœºå™¨äººè´¦å·ä¿¡æ¯æŸ¥è¯¢

### 2. AI æ™ºèƒ½å›å¤

- **è‡ªåŠ¨é—®ç­”**ï¼šæ¥æ”¶æ¶ˆæ¯åè‡ªåŠ¨è°ƒç”¨ AI ç”Ÿæˆæ™ºèƒ½å›å¤
- **ä¸Šä¸‹æ–‡è®°å¿†**ï¼šæ”¯æŒå¤šè½®å¯¹è¯ï¼Œç»´æŠ¤ç”¨æˆ·ä¼šè¯ä¸Šä¸‹æ–‡
- **åœºæ™¯è¯†åˆ«**ï¼šæ™ºèƒ½è¯†åˆ«ç§èŠå’Œç¾¤èŠåœºæ™¯
- **å¯é…ç½®**ï¼šæ”¯æŒåˆ‡æ¢ä¸åŒ AI æ¨¡å‹ï¼Œå¯å¼€å…³ AI å›å¤åŠŸèƒ½
- **æµå¼å“åº”**ï¼šæ”¯æŒæµå¼å’Œéæµå¼ä¸¤ç§å›å¤æ¨¡å¼

### 3. æ¶ˆæ¯å¤„ç†æµç¨‹

```
ä¼ä¸šå¾®ä¿¡ç”¨æˆ·
    â†“ (å‘é€æ¶ˆæ¯)
ä¼ä¸šå¾®ä¿¡æ‰˜ç®¡å¹³å°
    â†“ (æ¶ˆæ¯å›è°ƒ POST /message)
æœ¬æœåŠ¡
    â”œâ”€ è§£ææ¶ˆæ¯å†…å®¹
    â”œâ”€ è°ƒç”¨ AI Agent ç”Ÿæˆå›å¤
    â””â”€ é€šè¿‡æ‰˜ç®¡å¹³å°å‘é€å›å¤
    â†“
ä¼ä¸šå¾®ä¿¡ç”¨æˆ·æ”¶åˆ° AI å›å¤
```

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` é…ç½®ï¼š

```env
# Agent AI é…ç½®
AGENT_API_KEY=your_api_key                        # ä» https://wolian.cc è·å–
AGENT_API_BASE_URL=https://api.wolian.cc/api/v1  # AI API åœ°å€
AGENT_DEFAULT_MODEL=anthropic/claude-3-7-sonnet-20250219
ENABLE_AI_REPLY=true                              # å¯ç”¨/ç¦ç”¨ AI è‡ªåŠ¨å›å¤

# æ‰˜ç®¡å¹³å°é…ç½®
STRIDE_API_BASE_URL=https://stride-bg.dpclouds.com

# åº”ç”¨é…ç½®
PORT=8080
NODE_ENV=production
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
npm run start:dev

# ç”Ÿäº§æ¨¡å¼
npm run build
npm run start:prod
```

### 4. éªŒè¯æœåŠ¡

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8080/agent/health

# æŸ¥çœ‹å¯ç”¨ AI æ¨¡å‹
curl http://localhost:8080/agent/models
```

## é¡¹ç›®æ¶æ„

### ç›®å½•ç»“æ„

```
duliday-wecom-service/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ agent/                    # AI Agent æœåŠ¡æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ agent.service.ts     # AI å¯¹è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ agent-config.service.ts # AI é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ dto/                 # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â””â”€â”€ conversation/        # ä¼šè¯ç®¡ç†ï¼ˆå¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ï¼‰
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config/              # å…¨å±€é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ http/                # ç»Ÿä¸€ HTTP å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ bot/                 # æœºå™¨äººç®¡ç†
â”‚   â”‚   â”œâ”€â”€ chat/                # ä¼šè¯åˆ—è¡¨å’ŒèŠå¤©å†å²
â”‚   â”‚   â”œâ”€â”€ contact/             # è”ç³»äººç®¡ç†
â”‚   â”‚   â”œâ”€â”€ customer/            # å®¢æˆ·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ message/             # æ¶ˆæ¯æ¥æ”¶ï¼ˆå›è°ƒå¤„ç†ï¼‰
â”‚   â”‚   â”œâ”€â”€ message-sender/      # æ¶ˆæ¯å‘é€
â”‚   â”‚   â”œâ”€â”€ room/                # ç¾¤èŠç®¡ç†
â”‚   â”‚   â””â”€â”€ user/                # ç”¨æˆ·ç®¡ç†
â”‚   â”œâ”€â”€ app.module.ts
â”‚   â””â”€â”€ main.ts
â”œâ”€â”€ docs/                        # æ–‡æ¡£ç›®å½•
â”œâ”€â”€ .env.example                 # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ package.json
```

### æ ¸å¿ƒæ¨¡å—è¯´æ˜

| æ¨¡å— | èŒè´£ | ä¸»è¦åŠŸèƒ½ |
|------|------|----------|
| **agent** | AI æ™ºèƒ½æœåŠ¡ | AI å¯¹è¯ã€æ¨¡å‹ç®¡ç†ã€é…ç½®ç®¡ç† |
| **conversation** | ä¼šè¯ç®¡ç† | å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ã€ä¼šè¯ ID ç®¡ç† |
| **http** | HTTP å®¢æˆ·ç«¯ | ç»Ÿä¸€çš„ HTTP è¯·æ±‚å°è£…å’Œé”™è¯¯å¤„ç† |
| **message** | æ¶ˆæ¯æ¥æ”¶ | å¤„ç†æ‰˜ç®¡å¹³å°æ¶ˆæ¯å›è°ƒï¼Œè§¦å‘ AI å›å¤ |
| **message-sender** | æ¶ˆæ¯å‘é€ | è°ƒç”¨æ‰˜ç®¡å¹³å° API å‘é€æ¶ˆæ¯ |
| **chat** | ä¼šè¯æŸ¥è¯¢ | è·å–ä¼šè¯åˆ—è¡¨ã€èŠå¤©å†å² |
| **contact** | è”ç³»äººç®¡ç† | å¥½å‹æ·»åŠ /åˆ é™¤ã€è”ç³»äººæŸ¥è¯¢ |
| **room** | ç¾¤èŠç®¡ç† | åˆ›å»ºç¾¤èŠã€æˆå‘˜ç®¡ç†ã€ç¾¤å…¬å‘Š |
| **customer** | å®¢æˆ·ç®¡ç† | ä¼ä¸šå®¢æˆ·ä¿¡æ¯ç®¡ç† |
| **bot** | æœºå™¨äººç®¡ç† | æœºå™¨äººè´¦å·ä¿¡æ¯æŸ¥è¯¢ |

## API æ¥å£æ–‡æ¡£

### AI Agent æ¨¡å—

```bash
# å¥åº·æ£€æŸ¥
GET /agent/health

# è·å–å¯ç”¨ AI æ¨¡å‹åˆ—è¡¨
GET /agent/models

# è·å–å¯ç”¨å·¥å…·åˆ—è¡¨
GET /agent/tools

# æµ‹è¯•èŠå¤©æ¥å£
POST /agent/test-chat
{
  "message": "ä½ å¥½",
  "conversationId": "test-user"
}
```

### æ¶ˆæ¯å›è°ƒï¼ˆæ ¸å¿ƒæ¥å£ï¼‰

```bash
POST /message
{
  "token": "group_token",           # å°ç»„çº§ token
  "msgId": "msg-123",               # æ¶ˆæ¯ ID
  "fromUser": "wxid_xxxxx",         # å‘é€è€…å¾®ä¿¡ ID
  "content": "ç”¨æˆ·å‘é€çš„æ¶ˆæ¯",         # æ¶ˆæ¯å†…å®¹
  "messageType": "text",            # æ¶ˆæ¯ç±»å‹
  "timestamp": 1697000000000,       # æ—¶é—´æˆ³
  "isRoom": false,                  # false=ç§èŠï¼Œtrue=ç¾¤èŠ
  "roomId": ""                      # ç¾¤èŠ IDï¼ˆç¾¤èŠæ—¶ä½¿ç”¨ï¼‰
}
```

**å·¥ä½œæµç¨‹**ï¼š
1. æ‰˜ç®¡å¹³å°æ”¶åˆ°ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯åå›è°ƒæ­¤æ¥å£
2. æœåŠ¡è§£ææ¶ˆæ¯å¹¶è°ƒç”¨ AI Agent ç”Ÿæˆå›å¤
3. è‡ªåŠ¨é€šè¿‡æ‰˜ç®¡å¹³å° API å°†å›å¤å‘é€ç»™ç”¨æˆ·

### æ¶ˆæ¯å‘é€

```bash
# å‘é€æ¶ˆæ¯ï¼ˆå•èŠ/ç¾¤å‘ï¼‰
POST /message-sender/send
{
  "token": "group_token",
  "content": "æ¶ˆæ¯å†…å®¹",
  "toWxid": "wxid_xxxxx",          # æ¥æ”¶è€…å¾®ä¿¡ ID
  "msgType": 1                     # 1=æ–‡æœ¬ï¼Œ3=å›¾ç‰‡ï¼Œ34=è¯­éŸ³ï¼Œ43=è§†é¢‘
}

# ç¾¤å‘æ¶ˆæ¯
POST /message-sender/broadcast
{
  "token": "group_token",
  "content": "ç¾¤å‘æ¶ˆæ¯å†…å®¹",
  "toWxids": ["wxid_1", "wxid_2"], # æ¥æ”¶è€…åˆ—è¡¨
  "msgType": 1
}
```

### ä¼šè¯ç®¡ç†

```bash
# è·å–ä¼šè¯åˆ—è¡¨
GET /chat/list?token={token}&pageSize=20&iterator={cursor}

# è·å–èŠå¤©å†å²
GET /chat/history?token={token}&snapshotDay=2025-01-15&pageSize=100&seq={seq}
```

### è”ç³»äººç®¡ç†

```bash
# æ·»åŠ å¥½å‹
POST /contact/add
{
  "token": "group_token",
  "wxid": "wxid_xxxxx",           # ç›®æ ‡å¾®ä¿¡ ID
  "content": "ä½ å¥½ï¼Œæˆ‘æ˜¯..."      # éªŒè¯æ¶ˆæ¯
}

# åˆ é™¤å¥½å‹
POST /contact/delete
{
  "token": "group_token",
  "wxid": "wxid_xxxxx"
}

# è·å–è”ç³»äººåˆ—è¡¨
GET /contact/list?token={token}
```

### ç¾¤èŠç®¡ç†

```bash
# åˆ›å»ºç¾¤èŠ
POST /room/create
{
  "token": "group_token",
  "wxids": ["wxid_1", "wxid_2"]   # ç¾¤æˆå‘˜åˆ—è¡¨
}

# é‚€è¯·å…¥ç¾¤
POST /room/add-member
{
  "token": "group_token",
  "roomId": "room_xxxxx@chatroom",
  "wxids": ["wxid_3"]
}

# ç§»é™¤æˆå‘˜
POST /room/remove-member
{
  "token": "group_token",
  "roomId": "room_xxxxx@chatroom",
  "wxid": "wxid_3"
}
```

è¯¦ç»† API æ–‡æ¡£è¯·æŸ¥çœ‹ [API_CONFIG.md](./API_CONFIG.md)

## é…ç½®è¯´æ˜

### å¤šç¯å¢ƒé…ç½®æ”¯æŒ

é¡¹ç›®æ”¯æŒå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ä¸‰ç§ç¯å¢ƒçš„ç‹¬ç«‹é…ç½®ï¼š

| é…ç½®æ–‡ä»¶ | ç”¨é€” | ä½¿ç”¨å‘½ä»¤ |
|---------|------|----------|
| `.env.development` | å¼€å‘ç¯å¢ƒ | `npm run start:dev` |
| `.env.production` | ç”Ÿäº§ç¯å¢ƒ | `npm run start:prod` |
| `.env.test` | æµ‹è¯•ç¯å¢ƒ | `npm run test` |
| `.env` | æœ¬åœ°è¦†ç›–é…ç½®ï¼ˆå¯é€‰ï¼‰ | - |

### ä¸»è¦ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ | å¿…å¡« |
|------|------|--------|------|
| `AGENT_API_KEY` | AI Agent API å¯†é’¥ | - | âœ… |
| `AGENT_API_BASE_URL` | AI API åœ°å€ | http://localhost:3000/api/v1 | âœ… |
| `AGENT_DEFAULT_MODEL` | é»˜è®¤ AI æ¨¡å‹ | anthropic/claude-3-7-sonnet-20250219 | âŒ |
| `AGENT_API_TIMEOUT` | Agent API è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰ | 60000 | âŒ |
| `ENABLE_AI_REPLY` | å¯ç”¨ AI è‡ªåŠ¨å›å¤ | true | âŒ |
| `STRIDE_API_BASE_URL` | æ‰˜ç®¡å¹³å° API åœ°å€ | https://stride-bg.dpclouds.com | âœ… |
| `PORT` | æœåŠ¡ç«¯å£ | 8080 | âŒ |
| `NODE_ENV` | è¿è¡Œç¯å¢ƒ | development | âŒ |
| `CONVERSATION_MAX_MESSAGES` | ä¼šè¯æœ€å¤§æ¶ˆæ¯æ•° | 20 | âŒ |
| `CONVERSATION_TIMEOUT_MS` | ä¼šè¯è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰ | 7200000 | âŒ |
| `HTTP_CLIENT_TIMEOUT` | HTTP è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰ | 10000 | âŒ |

ğŸ“– **å®Œæ•´é…ç½®è¯´æ˜è¯·å‚è€ƒï¼š[ç¯å¢ƒå˜é‡é…ç½®æŒ‡å—](./docs/ENV_CONFIG.md)**

### å¿«é€Ÿé…ç½®

**1. åˆå§‹åŒ–é…ç½®æ–‡ä»¶**
```bash
# å¤åˆ¶æ¨¡æ¿æ–‡ä»¶ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
cp .env.example .env

# ç¼–è¾‘é…ç½®ï¼Œå¡«å…¥ä½ çš„ API Key
vim .env
```

**2. è·å– Agent API Key**
- è®¿é—® https://wolian.cc/platform/clients-management
- æ³¨å†Œå¹¶åˆ›å»º API Key
- å°† Key å¡«å…¥é…ç½®æ–‡ä»¶çš„ `AGENT_API_KEY`

**3. é…ç½®æ‰˜ç®¡å¹³å°**
- è·å–å°ç»„çº§æˆ–ä¼ä¸šçº§ Token
- åœ¨æ‰˜ç®¡å¹³å°åå°é…ç½®æ¶ˆæ¯å›è°ƒåœ°å€ï¼š`http://your-domain.com/message`
- ç¡®è®¤ `STRIDE_API_BASE_URL` é…ç½®æ­£ç¡®

## æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# å•å…ƒæµ‹è¯•
npm run test

# ç«¯åˆ°ç«¯æµ‹è¯•
npm run test:e2e

# AI é›†æˆæµ‹è¯•
npm run test:ai
```

### æ‰‹åŠ¨æµ‹è¯•

**1. æµ‹è¯• AI å¯¹è¯**

```bash
curl -X POST http://localhost:8080/agent/test-chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±",
    "conversationId": "test-001"
  }'
```

**2. æ¨¡æ‹Ÿæ¶ˆæ¯å›è°ƒ**

```bash
curl -X POST http://localhost:8080/message \
  -H "Content-Type: application/json" \
  -d '{
    "token": "test-token",
    "msgId": "msg-001",
    "fromUser": "wxid_test",
    "content": "ä½ å¥½",
    "messageType": "text",
    "timestamp": 1697000000000,
    "isRoom": false
  }'
```

**3. æµ‹è¯•å¤šè½®å¯¹è¯**

```bash
# ç¬¬ä¸€è½®
curl -X POST http://localhost:8080/message \
  -H "Content-Type: application/json" \
  -d '{
    "fromUser": "wxid_test",
    "content": "æˆ‘å«å¼ ä¸‰",
    "messageType": "text"
  }'

# ç¬¬äºŒè½®ï¼ˆæµ‹è¯•ä¸Šä¸‹æ–‡è®°å¿†ï¼‰
curl -X POST http://localhost:8080/message \
  -H "Content-Type: application/json" \
  -d '{
    "fromUser": "wxid_test",
    "content": "æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ",
    "messageType": "text"
  }'
```

## éƒ¨ç½²

### ä½¿ç”¨ PM2

```bash
npm run build
pm2 start dist/main.js --name duliday-wecom-service
pm2 save
```

### ä½¿ç”¨ Docker

```bash
# æ„å»ºé•œåƒ
docker build -t duliday-wecom-service .

# è¿è¡Œå®¹å™¨
docker run -d \
  -p 8080:8080 \
  --env-file .env \
  --name wecom-service \
  duliday-wecom-service
```

### ä½¿ç”¨ Docker Compose

```bash
docker-compose up -d
```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„ä¸šåŠ¡æ¨¡å—

1. åœ¨ `src/modules/` ä¸‹åˆ›å»ºæ–°æ¨¡å—ç›®å½•
2. åˆ›å»ºå¿…è¦çš„æ–‡ä»¶ï¼š
   ```
   your-module/
   â”œâ”€â”€ your-module.module.ts
   â”œâ”€â”€ your-module.service.ts
   â”œâ”€â”€ your-module.controller.ts
   â””â”€â”€ dto/
   ```
3. åœ¨ `app.module.ts` ä¸­å¯¼å…¥æ–°æ¨¡å—

### è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†é€»è¾‘

åœ¨ `src/modules/message/message.service.ts` ä¸­æ‰©å±•ï¼š

```typescript
async processMessage(messageData) {
  // è‡ªå®šä¹‰è¿‡æ»¤é€»è¾‘
  if (this.shouldIgnore(messageData.content)) {
    return { success: false, reason: 'å¿½ç•¥æ­¤æ¶ˆæ¯' };
  }

  // è°ƒç”¨ AI ç”Ÿæˆå›å¤
  const reply = await this.agentService.generateReply(
    messageData.content,
    messageData.fromUser
  );

  // å‘é€å›å¤
  await this.messageSenderService.sendMessage({
    token: messageData.token,
    content: reply,
    toWxid: messageData.fromUser
  });

  return { success: true };
}
```

### é›†æˆæ–°çš„ AI æœåŠ¡

åœ¨ `src/agent/agent.service.ts` ä¸­ä¿®æ”¹ AI è°ƒç”¨é€»è¾‘ï¼š

```typescript
async generateReply(message: string, userId: string) {
  // è·å–æˆ–åˆ›å»ºä¼šè¯ ID
  const conversationId = this.conversationService.getOrCreate(userId);

  // è°ƒç”¨ AI API
  const response = await this.httpService.post('/chat', {
    message,
    conversationId,
    model: this.configService.get('AGENT_DEFAULT_MODEL')
  });

  return response.data.reply;
}
```

## æ—¥å¿—

æ—¥å¿—æ–‡ä»¶ä½äº `logs/` ç›®å½•ï¼š

- `combined-YYYY-MM-DD.log` - æ‰€æœ‰æ—¥å¿—
- `error-YYYY-MM-DD.log` - é”™è¯¯æ—¥å¿—

æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼š

```bash
tail -f logs/combined-$(date +%Y-%m-%d).log
```

## å¸¸è§é—®é¢˜

### 1. AI å›å¤ä¸å·¥ä½œ

- æ£€æŸ¥ `ENABLE_AI_REPLY` æ˜¯å¦ä¸º `true`
- éªŒè¯ `AGENT_API_KEY` æ˜¯å¦æœ‰æ•ˆ
- æŸ¥çœ‹æ—¥å¿—ç¡®è®¤ AI API è°ƒç”¨æ˜¯å¦æˆåŠŸ

### 2. æ‰˜ç®¡å¹³å°è¿æ¥å¤±è´¥

- ç¡®è®¤ `STRIDE_API_BASE_URL` åœ°å€æ­£ç¡®
- æ£€æŸ¥ token æ˜¯å¦æœ‰æ•ˆ
- éªŒè¯ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

### 3. æ¶ˆæ¯å›è°ƒæœªè§¦å‘

- ç¡®è®¤æ‰˜ç®¡å¹³å°å·²é…ç½®å›è°ƒ URL
- æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œåœ¨é…ç½®çš„ç«¯å£
- æŸ¥çœ‹æ‰˜ç®¡å¹³å°åå°çš„å›è°ƒæ—¥å¿—

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**ï¼šNestJS 10.x
- **è¯­è¨€**ï¼šTypeScript 5.x
- **HTTP å®¢æˆ·ç«¯**ï¼šAxios
- **æ—¥å¿—**ï¼šWinston
- **é…ç½®ç®¡ç†**ï¼š@nestjs/config
- **æ–‡æ¡£**ï¼šSwagger

## ç›¸å…³èµ„æº

- **æ‰˜ç®¡å¹³å° API æ–‡æ¡£**
  - [ä¼ä¸šçº§ API](https://s.apifox.cn/34adc635-40ac-4161-8abb-8cd1eea9f445)
  - [å°ç»„çº§ API](https://s.apifox.cn/acec6592-fec1-443b-8563-10c4a10e64c4)
- **Agent API æ–‡æ¡£**ï¼šhttps://docs.wolian.cc/
- **NestJS æ–‡æ¡£**ï¼šhttps://docs.nestjs.com/

## è®¸å¯è¯

ISC

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** æŸ¥çœ‹ [å®Œæ•´æ–‡æ¡£](./docs/README.md) æˆ–æäº¤ Issueã€‚
