<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bot ÁõëÊéß‰ª™Ë°®Áõò - DuLiDay</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
      /* ========================================
         ÊüîÂÖâ AI È£éÊ†ºËÆæËÆ°Á≥ªÁªü - Soft AI Design
         ======================================== */

      :root {
        /* ‰∏ªËâ≤Ë∞É - Ê¢¶ÂπªËìùÁ¥´ */
        --primary: #6366f1;
        --primary-dark: #4f46e5;
        --primary-light: #818cf8;
        --primary-soft: rgba(99, 102, 241, 0.1);
        
        /* ËæÖÂä©Ëâ≤ */
        --accent: #8b5cf6;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --info: #06b6d4;

        /* ÊñáÂ≠óÈ¢úËâ≤ */
        --text-primary: #1f2937;
        --text-secondary: #6b7280;
        --text-muted: #9ca3af;
        --text-on-primary: #ffffff;

        /* ËÉåÊôØ‰∏éËæπÊ°Ü */
        --bg-page: #f3f4f6;
        --bg-sidebar: #ffffff;
        --bg-card: #ffffff;
        --border: #e5e7eb;
        --border-hover: #d1d5db;

        /* Ê∏êÂèò */
        --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        --gradient-card: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
        --gradient-hover: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);

        /* Èò¥ÂΩ± */
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-glow: 0 0 20px rgba(99, 102, 241, 0.15);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: 'PingFang SC', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: var(--bg-page);
        color: var(--text-primary);
        padding: 0;
      }

      /* ÊüîÂíåËÉåÊôØ */
      .background-gradients {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        overflow: hidden;
        background: #f3f4f6;
      }

      .bg-blue, .bg-purple {
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.5;
        animation: float 20s infinite ease-in-out;
      }

      .bg-blue, .bg-purple {
        position: absolute;
        border-radius: 50%;
        filter: blur(120px);
        opacity: 0.6;
        animation: float 25s infinite ease-in-out;
      }

      .bg-blue {
        top: -15%;
        left: -10%;
        width: 60vw;
        height: 60vw;
        background: radial-gradient(circle, rgba(99, 102, 241, 0.25), transparent 70%);
        animation-delay: 0s;
      }

      .bg-purple {
        bottom: -15%;
        right: -10%;
        width: 55vw;
        height: 55vw;
        background: radial-gradient(circle, rgba(139, 92, 246, 0.3), transparent 70%);
        animation-delay: -12s;
      }

      @keyframes float {
        0%, 100% { transform: translate(0, 0) scale(1); }
        33% { transform: translate(40px, -60px) scale(1.1); }
        66% { transform: translate(-30px, 30px) scale(0.95); }
      }

      .container {
        position: relative;
        z-index: 1;
        max-width: 1440px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .header {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 32px;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .header-top {
        display: flex;
        justify-content: space-between;
        gap: 24px;
        flex-wrap: wrap;
      }

      /* Áªü‰∏ÄÊéßÂà∂Èù¢Êùø - ÂêàÂπ∂ header ÂíåÂÅ•Â∫∑Áä∂ÊÄÅ */
      .control-panel {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.06) 0%, rgba(147, 51, 234, 0.06) 50%, rgba(236, 72, 153, 0.04) 100%);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 24px 32px;
        position: relative;
        overflow: hidden;
        margin-bottom: 0;
      }

      .control-panel::before {
        content: '';
        position: absolute;
        top: -60%;
        right: -15%;
        width: 400px;
        height: 400px;
        background: radial-gradient(circle, rgba(59, 130, 246, 0.12) 0%, transparent 70%);
        pointer-events: none;
      }

      .control-panel::after {
        content: '';
        position: absolute;
        bottom: -40%;
        left: -5%;
        width: 250px;
        height: 250px;
        background: radial-gradient(circle, rgba(147, 51, 234, 0.08) 0%, transparent 70%);
        pointer-events: none;
      }

      .control-panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 20px;
        margin-bottom: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        position: relative;
        z-index: 1;
      }

      .control-panel-left {
        display: flex;
        align-items: center;
        gap: 24px;
      }

      .control-panel-right {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .control-panel-title {
        font-size: 15px;
        font-weight: 600;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
        padding-right: 20px;
        border-right: 1px solid rgba(255, 255, 255, 0.1);
      }

      .control-panel-title::before {
        content: '‚ö°';
        font-size: 16px;
      }

      .control-panel .filters {
        margin: 0;
      }

      .control-panel .health-grid {
        position: relative;
        z-index: 1;
      }

      .control-panel .health-panel-badge {
        font-size: 11px;
        padding: 4px 10px;
        border-radius: 12px;
        background: rgba(34, 197, 94, 0.15);
        color: var(--success);
        font-weight: 500;
      }

      .control-panel .health-panel-badge.warning {
        background: rgba(245, 158, 11, 0.15);
        color: var(--warning);
      }

      .control-panel .health-panel-badge.error {
        background: rgba(239, 68, 68, 0.15);
        color: var(--danger);
      }

      /* Ë£ÖÈ•∞ÊÄßÂÖâÁÇπÊïàÊûú */
      .control-panel .decorative-dot {
        position: absolute;
        border-radius: 50%;
        background: rgba(59, 130, 246, 0.3);
        filter: blur(1px);
        pointer-events: none;
        z-index: 0;
      }

      .control-panel .decorative-dot:nth-child(1) {
        top: 20px;
        right: 100px;
        width: 6px;
        height: 6px;
        animation: pulse-dot 3s infinite;
      }

      .control-panel .decorative-dot:nth-child(2) {
        bottom: 30px;
        right: 200px;
        width: 4px;
        height: 4px;
        background: rgba(147, 51, 234, 0.4);
        animation: pulse-dot 4s infinite 1s;
      }

      @keyframes pulse-dot {
        0%, 100% { opacity: 0.3; transform: scale(1); }
        50% { opacity: 0.8; transform: scale(1.5); }
      }

      .header h1 {
        margin: 4px 0 8px;
        font-size: 28px;
      }

      .eyebrow {
        color: var(--text-muted);
        font-size: 13px;
        letter-spacing: 0.2em;
        text-transform: uppercase;
      }

      .header-actions {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .filters {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .filters {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .filters button {
        background: rgba(255, 255, 255, 0.6);
        border: 1px solid var(--border);
        color: var(--text-secondary);
        border-radius: 999px;
        padding: 6px 14px;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .filters button:hover {
        border-color: var(--primary);
        background: rgba(139, 92, 246, 0.08);
        color: var(--primary);
      }

      .filters button.active {
        background: var(--gradient-primary);
        border-color: transparent;
        color: #fff;
        box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
      }

      .header-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
      }

      .btn {
        border-radius: 10px;
        padding: 10px 16px;
        border: 1px solid transparent;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .btn-primary {
        background: var(--gradient-primary);
        color: #fff;
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4);
      }

      .btn-ghost {
        background: rgba(255, 255, 255, 0.6);
        border-color: var(--border);
        color: var(--text-secondary);
      }

      .btn-ghost:hover {
        background: rgba(255, 255, 255, 0.9);
        border-color: var(--border-hover);
        color: var(--text-primary);
      }

      .auto-refresh {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
        color: var(--text-secondary);
      }

      .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--success);
        box-shadow: 0 0 12px rgba(16, 185, 129, 0.7);
      }

      /* ÂºÄÂÖ≥Ê†∑Âºè */
      .toggle-switch {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 13px;
        color: var(--text-secondary);
      }

      .toggle-switch input[type='checkbox'] {
        appearance: none;
        width: 44px;
        height: 24px;
        background: rgba(148, 163, 184, 0.2);
        border: 1px solid var(--border);
        border-radius: 12px;
        position: relative;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .toggle-switch input[type='checkbox']::before {
        content: '';
        position: absolute;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: var(--text-muted);
        top: 2px;
        left: 2px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .toggle-switch input[type='checkbox']:checked {
        background: var(--success);
        border-color: var(--success);
      }

      .toggle-switch input[type='checkbox']:checked::before {
        background: white;
        left: 22px;
      }

      .toggle-switch input[type='checkbox']:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .toggle-switch .status-text {
        min-width: 40px;
        font-weight: 500;
      }

      .toggle-switch .status-text.enabled {
        color: var(--success);
      }

      .toggle-switch .status-text.disabled {
        color: var(--danger);
      }

      .last-update {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
        font-size: 13px;
      }

      .section {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 24px;
      }

      .page-footnote {
        margin-top: 12px;
        text-align: right;
        color: var(--text-muted);
        font-size: 12px;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 12px;
      }

      .btn-ghost.danger-link {
        border-color: transparent;
        color: var(--text-muted);
        padding: 6px 10px;
        font-size: 12px;
      }

      .btn-ghost.danger-link:hover {
        color: var(--danger);
        border-color: rgba(239, 68, 68, 0.3);
      }

      .health-panel {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(147, 51, 234, 0.08) 100%);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 24px 32px;
        position: relative;
        overflow: hidden;
      }

      .health-panel::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -20%;
        width: 300px;
        height: 300px;
        background: radial-gradient(circle, rgba(59, 130, 246, 0.15) 0%, transparent 70%);
        pointer-events: none;
      }

      .health-panel::after {
        content: '';
        position: absolute;
        bottom: -30%;
        left: -10%;
        width: 200px;
        height: 200px;
        background: radial-gradient(circle, rgba(147, 51, 234, 0.1) 0%, transparent 70%);
        pointer-events: none;
      }

      .health-panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        position: relative;
        z-index: 1;
      }

      .health-panel-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .health-panel-title::before {
        content: '‚ö°';
        font-size: 18px;
      }

      .health-panel-badge {
        font-size: 11px;
        padding: 4px 10px;
        border-radius: 12px;
        background: rgba(34, 197, 94, 0.15);
        color: var(--success);
        font-weight: 500;
      }

      .health-panel-badge.warning {
        background: rgba(245, 158, 11, 0.15);
        color: var(--warning);
      }

      .health-panel-badge.error {
        background: rgba(239, 68, 68, 0.15);
        color: var(--danger);
      }

      .health-grid {
        display: grid;
        gap: 12px;
        grid-template-columns: repeat(4, 1fr);
        position: relative;
        z-index: 1;
      }

      .health-item {
        display: flex;
        gap: 10px;
        align-items: center;
        padding: 12px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.15);
        transition: all 0.2s ease;
      }

      .health-item:hover {
        background: rgba(255, 255, 255, 0.8);
        border-color: rgba(148, 163, 184, 0.25);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(148, 163, 184, 0.15);
      }

      .health-item[data-state='error'] {
        border-color: rgba(239, 68, 68, 0.3);
        background: rgba(239, 68, 68, 0.06);
      }

      .health-item[data-state='warning'] {
        border-color: rgba(245, 158, 11, 0.3);
        background: rgba(245, 158, 11, 0.06);
      }

      .health-icon {
        font-size: 28px;
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(139, 92, 246, 0.1);
        border-radius: 12px;
      }

      .health-info {
        flex: 1;
      }

      .health-title {
        font-size: 12px;
        color: var(--text-muted);
        letter-spacing: 0.05em;
        margin-bottom: 4px;
      }

      .health-status {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 2px;
      }

      .health-desc {
        color: var(--text-secondary);
        font-size: 12px;
      }

      .metric-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 16px;
      }

      .metric-card {
        background: var(--bg-card);
        border-radius: 20px;
        padding: 24px;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
        border: 1px solid var(--border);
        box-shadow: var(--shadow-sm);
      }

      .metric-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary-light);
      }

      .metric-card::after {
        content: '';
        position: absolute;
        inset: 0;
        opacity: 0.6;
        pointer-events: none;
        border-radius: inherit;
      }

      .metric-card.primary::after {
        background: radial-gradient(circle at top right, rgba(59, 130, 246, 0.15), transparent 70%);
      }

      .metric-value {
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 700;
        letter-spacing: -0.02em;
      }

      .metric-card.success::after {
        background: radial-gradient(circle at top right, rgba(16, 185, 129, 0.15), transparent 70%);
      }

      .metric-card.warning::after {
        background: radial-gradient(circle at top right, rgba(245, 158, 11, 0.15), transparent 70%);
      }

      .metric-card.danger::after {
        background: radial-gradient(circle at top right, rgba(239, 68, 68, 0.15), transparent 70%);
      }

      .metric-card.info::after {
        background: radial-gradient(circle at top right, rgba(6, 182, 212, 0.15), transparent 70%);
      }

      .metric-label {
        font-size: 13px;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .metric-subtitle {
        font-size: 13px;
        color: var(--text-secondary);
      }

      .metric-delta {
        font-size: 13px;
        font-weight: 600;
      }

      .metric-delta.positive {
        color: var(--success);
      }

      .metric-delta.negative {
        color: var(--danger);
      }

      .charts-row {
        display: grid;
        gap: 20px;
        grid-template-columns: 2fr 1fr;
      }

      .chart-card {
        border-radius: 20px;
        border: 1px solid var(--border);
        padding: 24px;
        background: var(--bg-card);
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
      }

      .chart-header h3 {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
      }

      .chart-header p {
        margin: 2px 0 0;
        color: var(--text-secondary);
        font-size: 13px;
      }

      .chart-kpi {
        text-align: right;
        font-size: 12px;
        color: var(--text-muted);
      }

      .chart-kpi strong {
        display: block;
        font-size: 18px;
        color: var(--text-primary);
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: rgba(148, 163, 184, 0.3);
        border-radius: 3px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: rgba(148, 163, 184, 0.5);
      }

      canvas {
        width: 100% !important;
        height: 280px !important;
        filter: drop-shadow(0 4px 8px rgba(148, 163, 184, 0.15));
      }

      .chart-container {
        position: relative;
        width: 100%;
        height: 280px;
      }

      .insight-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
      }

      .insight-card {
        border-radius: 18px;
        padding: 24px;
        min-height: 140px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        position: relative;
        overflow: hidden;
      }
      
      .insight-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, transparent, rgba(139, 92, 246, 0.08), transparent);
        transform: translateX(-100%);
        transition: transform 0.6s;
      }

      .insight-card:hover::before {
        transform: translateX(100%);
      }

      .insight-title {
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-muted);
        margin-bottom: 12px;
      }

      .insight-metrics {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
      }

      .insight-metrics div span {
        font-size: 12px;
        color: var(--text-secondary);
      }

      .insight-metrics div strong {
        display: block;
        font-size: 20px;
      }

      .percentiles {
        display: grid;
        grid-template-columns: repeat(2, minmax(100px, 1fr));
        gap: 12px;
      }

      .percentiles span {
        font-size: 12px;
        color: var(--text-secondary);
      }

      .percentiles strong {
        display: block;
        font-size: 18px;
      }

      .alert-type-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .alert-type-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 0;
        border-bottom: 1px solid var(--border);
      }

      .alert-type-item:last-child {
        border-bottom: none;
      }

      .alert-type-label {
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 100px;
        font-size: 13px;
      }

      .alert-type-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 20px;
        height: 20px;
        border-radius: 6px;
        font-size: 11px;
      }

      .alert-type-badge.agent {
        background: rgba(239, 68, 68, 0.2);
        color: var(--danger);
      }

      .alert-type-badge.message {
        background: rgba(245, 158, 11, 0.2);
        color: var(--warning);
      }

      .alert-type-badge.delivery {
        background: rgba(59, 130, 246, 0.2);
        color: var(--primary);
      }

      .alert-type-badge.merge {
        background: rgba(168, 85, 247, 0.2);
        color: #a855f7;
      }

      .alert-type-badge.unknown {
        background: rgba(156, 163, 175, 0.2);
        color: var(--text-muted);
      }

      .alert-type-bar {
        flex: 1;
        height: 6px;
        background: rgba(148, 163, 184, 0.15);
        border-radius: 3px;
        overflow: hidden;
        position: relative;
      }

      .alert-type-bar-fill {
        height: 100%;
        border-radius: 3px;
        transition: width 0.3s ease;
      }

      .alert-type-bar-fill.agent {
        background: var(--danger);
      }

      .alert-type-bar-fill.message {
        background: var(--warning);
      }

      .alert-type-bar-fill.delivery {
        background: var(--primary);
      }

      .alert-type-bar-fill.merge {
        background: #a855f7;
      }

      .alert-type-bar-fill.unknown {
        background: var(--text-muted);
      }

      .alert-type-stats {
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 80px;
        justify-content: flex-end;
        font-size: 12px;
      }

      .alert-type-count {
        font-weight: 600;
        color: var(--text-primary);
      }

      .alert-type-percentage {
        color: var(--text-secondary);
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .section-header h3 {
        margin: 0;
        font-size: 16px;
      }

      .table-wrapper {
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead th {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--text-muted);
        padding: 10px 12px;
        border-bottom: 1px solid var(--border);
        text-align: left;
      }

      tbody td {
        padding: 12px;
        border-bottom: 1px solid var(--border);
        font-size: 13px;
        color: var(--text-secondary);
      }

      tbody tr:hover {
        background: rgba(139, 92, 246, 0.04);
      }

      .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border-radius: 999px;
        padding: 2px 10px;
        font-size: 12px;
        border: 1px solid transparent;
      }

      .status-badge.success {
        border-color: rgba(16, 185, 129, 0.4);
        color: var(--success);
      }

      .status-badge.warning {
        border-color: rgba(245, 158, 11, 0.4);
        color: var(--warning);
      }

      .status-badge.danger {
        border-color: rgba(239, 68, 68, 0.4);
        color: var(--danger);
      }

      .loading {
        padding: 24px;
        text-align: center;
        color: var(--text-secondary);
      }

      /* Âä†ËΩΩÂä®Áîª */
      @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
      }

      .skeleton {
        background: linear-gradient(90deg,
          rgba(148, 163, 184, 0.1) 25%,
          rgba(148, 163, 184, 0.2) 50%,
          rgba(148, 163, 184, 0.1) 75%
        );
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
        border-radius: 4px;
      }

      /* ÈÄâ‰∏≠Áä∂ÊÄÅ */
      ::selection {
        background: rgba(139, 92, 246, 0.3);
        color: var(--text-primary);
      }

      @media (max-width: 1200px) {
        .metric-grid {
          grid-template-columns: repeat(3, 1fr);
        }
        .insight-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 960px) {
        .charts-row {
          grid-template-columns: 1fr;
        }
        .health-grid {
          grid-template-columns: repeat(2, 1fr);
        }
        .metric-grid {
          grid-template-columns: repeat(2, 1fr);
        }
        .insight-grid {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 600px) {
        .health-grid {
          grid-template-columns: 1fr;
        }
      }

      /* App Layout & Sidebar */

      .sidebar {
        width: 280px;
        /* Subtle Winter Gradient */
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.95) 0%, rgba(240, 249, 255, 0.9) 100%);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.6);
        display: flex;
        flex-direction: column;
        position: fixed;
        top: 16px;
        bottom: 16px;
        left: 16px;
        z-index: 50;
        padding: 24px;
        border-radius: 24px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.04);
        overflow: hidden; /* Clip watermarks */
      }

      .sidebar-watermark {
        position: absolute;
        top: 5%;
        right: -30px;
        font-size: 240px;
        opacity: 0.03;
        pointer-events: none;
        z-index: 0;
        filter: blur(1px);
        transform: rotate(15deg);
        user-select: none;
      }

      .sidebar-watermark-2 {
        position: absolute;
        bottom: 15%;
        left: -30px;
        font-size: 180px;
        opacity: 0.04;
        pointer-events: none;
        z-index: 0;
        filter: blur(1px);
        transform: rotate(-10deg);
        user-select: none;
      }

      .content {
        flex: 1;
        margin-left: 312px; /* 280 + 16 + 16 */
        padding: 40px 40px 80px 0;
        min-width: 0;
      }

      .sidebar-logo {
        font-size: 22px;
        font-weight: 800;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 14px;
        margin-bottom: 8px;
        padding: 0 8px;
      }

      .sidebar-logo span {
        background: var(--gradient-primary);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-size: 28px;
        filter: drop-shadow(0 2px 4px rgba(99, 102, 241, 0.2));
      }
      /* Christmas Design Elements */
      .christmas-card {
        margin-top: 16px;
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        border-radius: 16px;
        padding: 16px;
        position: relative;
        overflow: hidden;
        color: white;
        box-shadow: 0 4px 12px rgba(220, 38, 38, 0.25);
        cursor: default;
      }

      .santa-floating {
        position: absolute;
        top: -10px;
        right: 10px;
        font-size: 32px;
        filter: drop-shadow(0 4px 6px rgba(0,0,0,0.15));
        animation: santaFloat 3s ease-in-out infinite;
        z-index: 20;
      }

      @keyframes santaFloat {
        0%, 100% { transform: rotate(-5deg) translateY(0); }
        50% { transform: rotate(5deg) translateY(-6px); }
      }

      /* Christmas Decorations for Cards */
      .metric-card, .chart-card, .insight-card {
        position: relative;
        overflow: hidden;
      }

      .metric-card::before, .chart-card::before, .insight-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #ef4444 0%, #ffffff 50%, #10b981 100%);
        z-index: 10;
        opacity: 0.8;
      }

      .metric-card::after, .insight-card::after {
        content: '‚ùÑÔ∏è';
        position: absolute;
        top: -10px;
        right: -10px;
        font-size: 48px;
        opacity: 0.05;
        transform: rotate(15deg);
        pointer-events: none;
      }

      /* Insight Card Styling (System Page) */
      .insight-card {
        background: var(--bg-card);
        border-radius: 20px;
        padding: 24px;
        border: 1px solid var(--border);
        box-shadow: var(--shadow-sm);
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .insight-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary-light);
      }

      .insight-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .insight-metrics {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
      }

      .insight-metrics div {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .insight-metrics span {
        font-size: 12px;
        color: var(--text-secondary);
      }

      .insight-metrics strong {
        font-size: 18px;
        color: var(--text-primary);
        font-weight: 700;
      }

      /* Christmas Decorations for Sidebar Icons */
      .nav-item {
        position: relative;
      }

      .nav-item::after {
        content: 'üéÑ';
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 12px;
        opacity: 0;
        transition: all 0.3s ease;
      }

      .nav-icon {
        width: 24px;
        height: 24px;
        margin-right: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        object-fit: contain;
        transition: all 0.3s ease;
      }

      /* Style for SVG icons to match Christmas theme */
      .nav-icon svg {
        width: 100%;
        height: 100%;
      }

      .icon-system { color: #ef4444; /* Christmas Red */ }
      .icon-logs { color: #10b981; /* Christmas Green */ }

      .nav-item:hover::after, .nav-item.active::after {
        opacity: 1;
        transform: translateY(-50%) scale(1.2);
      }

      /* =========================================
         More Christmas Elements (Stickers & Garland)
         ========================================= */
      .christmas-sticker {
        position: absolute;
        font-size: 28px;
        z-index: 15;
        pointer-events: none;
        filter: drop-shadow(0 4px 4px rgba(0,0,0,0.15));
        transition: all 0.3s ease;
      }
      
      .metric-card:hover .christmas-sticker,
      .chart-card:hover .christmas-sticker {
        transform: scale(1.2) rotate(10deg);
      }

      .sticker-tr { top: -8px; right: -8px; transform: rotate(15deg); }
      .sticker-tl { top: -8px; left: -8px; transform: rotate(-15deg); }
      .sticker-float { 
        animation: floatSticker 4s ease-in-out infinite;
      }

      @keyframes floatSticker {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-5px) rotate(5deg); }
      }

      /* Hanging Garland */
      .christmas-garland {
        position: fixed;
        top: 0;
        left: 320px; /* Sidebar width + gap */
        right: 40px;
        height: 60px;
        z-index: 40;
        display: flex;
        justify-content: space-between;
        pointer-events: none;
        padding: 0 20px;
      }

      .garland-string {
        position: absolute;
        top: -10px;
        left: 0;
        right: 0;
        height: 20px;
        border-bottom: 2px dashed rgba(220, 38, 38, 0.3);
        border-radius: 50%;
        z-index: -1;
      }

      .garland-item {
        font-size: 32px;
        margin-top: 10px;
        transform-origin: top center;
        animation: swing 3s ease-in-out infinite;
        filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
      }

      @keyframes swing {
        0%, 100% { transform: rotate(-8deg); }
        50% { transform: rotate(8deg); }
      }

      .christmas-title {
        font-size: 14px;
        font-weight: 700;
        margin-bottom: 4px;
        display: flex;
        align-items: center;
        gap: 6px;
        position: relative;
        z-index: 2;
      }

      .christmas-text {
        font-size: 11px;
        opacity: 0.9;
        line-height: 1.4;
        position: relative;
        z-index: 2;
      }

      /* Subtle Snow Animation inside card */
      .snowflake {
        color: rgba(255, 255, 255, 0.3);
        font-size: 1em;
        font-family: Arial, sans-serif;
        text-shadow: 0 0 5px #000;
        position: absolute;
        top: -10%;
        z-index: 1;
        animation: snowflakes-fall 5s linear infinite, snowflakes-shake 3s ease-in-out infinite;
      }

      .snowflake:nth-of-type(1) { left: 10%; animation-delay: 0s, 0s; }
      .snowflake:nth-of-type(2) { left: 50%; animation-delay: 2s, 1s; font-size: 1.5em; }
      .snowflake:nth-of-type(3) { left: 80%; animation-delay: 4s, 2s; }

      @keyframes snowflakes-fall {
        0% { top: -10%; }
        100% { top: 100%; }
      }

      @keyframes snowflakes-shake {
        0%, 100% { transform: translateX(0); }
        50% { transform: translateX(20px); }
      }

      .sidebar-menu {
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex: 1;
        overflow-y: auto;
        padding: 4px;
      }

      .sidebar-footer {
        margin-top: auto;
        padding-top: 20px;
      }

      .nav-group-title {
        font-size: 11px;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-weight: 600;
        margin: 24px 0 12px 12px;
      }

      .nav-group-title:first-child {
        margin-top: 12px;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 14px 18px;
        border-radius: 16px;
        color: var(--text-secondary);
        text-decoration: none;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        font-size: 15px;
        font-weight: 500;
        position: relative;
        overflow: hidden;
      }

      .nav-item:hover {
        background: rgba(99, 102, 241, 0.05);
        color: var(--primary);
        transform: translateX(4px);
      }

      .nav-item.active {
        background: var(--gradient-primary);
        color: #ffffff;
        box-shadow: 0 8px 20px rgba(99, 102, 241, 0.25);
        font-weight: 600;
      }

      .nav-item.active .nav-icon {
        /* filter: brightness(0) invert(1);  Removed to keep emoji colors */
        transform: scale(1.1);
      }

      .page-section {
        display: none;
        flex-direction: column;
        gap: 24px;
        animation: fadeIn 0.3s ease;
      }

      .page-section.active {
        display: flex;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* Adjust container to fit in content area */
      .container {
        margin: 0;
        max-width: 1200px;
      }

      /* Pagination styles */
      .pagination {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid var(--border);
      }

      .pagination-info {
        font-size: 13px;
        color: var(--text-secondary);
      }

      .pagination-controls {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .pagination-btn {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text-secondary);
        border-radius: 8px;
        padding: 6px 12px;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .pagination-btn:hover:not(:disabled) {
        border-color: var(--primary);
        color: var(--text-primary);
      }

      .pagination-btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }

      .pagination-pages {
        display: flex;
        gap: 4px;
      }

      .pagination-page {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text-secondary);
        border-radius: 6px;
        padding: 6px 10px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        min-width: 32px;
        text-align: center;
      }

      .pagination-page:hover {
        border-color: var(--primary);
        color: var(--text-primary);
      }

      .pagination-page.active {
        background: var(--primary);
        border-color: var(--primary);
        color: white;
      }

      .page-size-select {
        background: var(--bg-card);
        border: 1px solid var(--border);
        color: var(--text-secondary);
        border-radius: 8px;
        padding: 6px 8px;
        font-size: 13px;
        cursor: pointer;
      }

      .page-size-select:focus {
        outline: none;
        border-color: var(--primary);
      }
    </style>
  </head>
  <body>
    <div class="background-gradients">
      <span class="bg-blue"></span>
      <span class="bg-purple"></span>
    </div>
    <div class="app-layout">
      <aside class="sidebar">
        <!-- Background Decorations -->
        <div class="sidebar-watermark">‚ùÑÔ∏è</div>
        <div class="sidebar-watermark-2">üéÑ</div>

        <div class="sidebar-header">
          <div class="sidebar-logo">
            <span>ü§ñ</span> Áã¨Á´ãÊó• Bot
          </div>
        </div>
        <div class="sidebar-menu">
          <div class="nav-group-title">Ê¶ÇËßà</div>
          <div class="nav-item active" onclick="switchPage('dashboard')" id="nav-dashboard">
            <img src="icons/dashboard.png" class="nav-icon" alt="Dashboard"> ‰ª™Ë°®Áõò
          </div>
          
          <div class="nav-group-title">ÁÆ°ÁêÜ</div>
          <div class="nav-item" onclick="switchPage('users')" id="nav-users">
            <img src="icons/users.png" class="nav-icon" alt="Users"> Áî®Êà∑ÁÆ°ÁêÜ
          </div>
          <div class="nav-item" onclick="switchPage('system')" id="nav-system">
            <span class="nav-icon icon-system">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z"></path><path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"></path><path d="M12 2v2"></path><path d="M12 22v-2"></path><path d="m17 20.66-1-1.73"></path><path d="M11 10.27 7 3.34"></path><path d="m20.66 17-1.73-1"></path><path d="m3.34 7 1.73 1"></path><path d="M14 12h8"></path><path d="M2 12h2"></path><path d="m20.66 7-1.73 1"></path><path d="m3.34 17 1.73-1"></path><path d="m17 3.34-1 1.73"></path><path d="m11 13.73-4 6.93"></path></svg>
            </span> Á≥ªÁªüÁõëÊéß
          </div>
          
          <div class="nav-group-title">Êó•Âøó</div>
          <div class="nav-item" onclick="switchPage('logs')" id="nav-logs">
            <span class="nav-icon icon-logs">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
            </span> Ê∂àÊÅØÊó•Âøó
          </div>
        </div>

        <div class="sidebar-footer" style="position: relative;">
          <div class="santa-floating">üéÖ</div>
          
          <!-- Christmas Decorative Element -->
          <div class="christmas-card">
            <div class="christmas-title">Merry Christmas! üéÑ</div>
            <div class="christmas-text">May your code be bug-free and your holidays bright.</div>
            <div class="snowflakes" aria-hidden="true">
              <div class="snowflake">‚ùÖ</div>
              <div class="snowflake">‚ùÜ</div>
              <div class="snowflake">‚ùÖ</div>
            </div>
          </div>
        </div>
      </aside>
      <main class="content">
        <div class="container">
          <!-- Page: Dashboard (‰ª™Ë°®Áõò) -->
          <div id="page-dashboard" class="page-section active">
            <!-- Áªü‰∏ÄÊéßÂà∂Èù¢Êùø - ÂêàÂπ∂Á≠õÈÄâÂíåÂÅ•Â∫∑Áä∂ÊÄÅ -->
            <section class="control-panel">
              <!-- Ë£ÖÈ•∞ÊÄßÂÖâÁÇπ -->
              <span class="decorative-dot"></span>
              <span class="decorative-dot"></span>
              <div class="control-panel-header">
                <div class="control-panel-left">
                  <div class="control-panel-title">Á≥ªÁªüÊéßÂà∂</div>
                  <div class="filters">
                    <button class="active" data-range="today">Êú¨Êó•</button>
                    <button data-range="week">Êú¨Âë®</button>
                    <button data-range="month">Êú¨Êúà</button>
                  </div>
                  <label class="toggle-switch">
                    <span>ü§ñ Êô∫ËÉΩÂõûÂ§ç</span>
                    <input type="checkbox" id="aiReplyToggle" />
                    <span class="status-text" id="aiReplyStatus">-</span>
                  </label>
                </div>
                <div class="control-panel-right">
                  <span class="health-panel-badge" id="overallHealthBadge">Ê£ÄÊü•‰∏≠...</span>
                  <label class="auto-refresh">
                    <input type="checkbox" id="autoRefresh" checked />
                    Ëá™Âä®Âà∑Êñ∞
                  </label>
                  <div class="last-update">
                    <span class="status-indicator"></span>
                    <span id="lastUpdate">-</span>
                  </div>
                </div>
              </div>
              <div class="health-grid">
                <article class="health-item" id="overallHealthCard" data-state="loading">
                  <div class="health-icon">üõ∞Ô∏è</div>
                  <div class="health-info">
                    <div class="health-title">Êï¥‰ΩìÁä∂ÊÄÅ</div>
                    <div class="health-status" id="overallHealthStatus">-</div>
                    <div class="health-desc" id="overallHealthMessage">Ê£ÄÊü•‰∏≠...</div>
                  </div>
                </article>
                <article class="health-item" id="modelHealthCard" data-state="loading">
                  <div class="health-icon">ü§ñ</div>
                  <div class="health-info">
                    <div class="health-title">AI Ê®°Âûã</div>
                    <div class="health-status" id="modelHealthStatus">-</div>
                    <div class="health-desc" id="modelHealthDetails">Ê£ÄÊü•‰∏≠...</div>
                  </div>
                </article>
                <article class="health-item" id="toolHealthCard" data-state="loading">
                  <div class="health-icon">üß∞</div>
                  <div class="health-info">
                    <div class="health-title">Â∑•ÂÖ∑ÊúçÂä°</div>
                    <div class="health-status" id="toolHealthStatus">-</div>
                    <div class="health-desc" id="toolHealthDetails">Ê£ÄÊü•‰∏≠...</div>
                  </div>
                </article>
                <article class="health-item" id="brandHealthCard" data-state="loading">
                  <div class="health-icon">üè∑Ô∏è</div>
                  <div class="health-info">
                    <div class="health-title">ÂìÅÁâåÊï∞ÊçÆ</div>
                    <div class="health-status" id="brandHealthStatus">-</div>
                    <div class="health-desc" id="brandHealthDetails">Ê£ÄÊü•‰∏≠...</div>
                  </div>
                </article>
              </div>
            </section>

            <!-- Ê†∏ÂøÉÊåáÊ†á -->
            <section class="metric-grid">
              <article class="metric-card primary">
                <div class="metric-label">
                  Ê∂àÊÅØÊÄªÈáè
                  <span class="time-range-badge" id="timeRangeBadge" style="font-size: 11px; opacity: 0.7;"></span>
                </div>
                <div class="metric-value" id="totalMessages">-</div>
                <div class="metric-subtitle">ÊàêÂäü + Â§±Ë¥•</div>
                <div class="metric-delta" id="totalMessagesDelta">-</div>
              </article>
              <article class="metric-card success">
                <div class="metric-label">ÊàêÂäüÁéá</div>
                <div class="metric-value" id="successRate">-</div>
                <div class="metric-subtitle" id="successCount">-</div>
                <div class="metric-delta" id="successRateDelta">-</div>
              </article>
              <article class="metric-card">
                <div class="metric-label">Âπ≥ÂùáÂìçÂ∫î</div>
                <div class="metric-value" id="avgDuration">-</div>
                <div class="metric-subtitle">Áßí</div>
                <div class="metric-delta" id="avgDurationDelta">-</div>
              </article>
              <article class="metric-card">
                <div class="metric-label">Ê¥ªË∑ÉÁî®Êà∑</div>
                <div class="metric-value" id="activeUsers">-</div>
                <div class="metric-subtitle" id="activeChats">-</div>
                <div class="metric-delta" id="activeUsersDelta">-</div>
              </article>
              <article class="metric-card" style="border: 1px solid rgba(245, 158, 11, 0.3);">
                <div class="metric-label">ÈôçÁ∫ßÊ¨°Êï∞</div>
                <div class="metric-value" id="fallbackCount">-</div>
                <div class="metric-subtitle" id="fallbackRate">-</div>
                <div class="metric-delta" id="fallbackDelta">-</div>
              </article>
            </section>

            <!-- ‰∏öÂä°ÊåáÊ†áÂç°Áâá -->
            <section class="metric-grid" style="grid-template-columns: repeat(3, 1fr);">
              <article class="metric-card" style="border: 1px solid rgba(99, 102, 241, 0.3);">
                <div class="metric-label">
                  ÊÄªÂí®ËØ¢‰∫∫Êï∞
                  <span class="time-range-badge" id="businessTimeRangeBadge" style="font-size: 11px; opacity: 0.7;"></span>
                </div>
                <div class="metric-value" id="businessConsultationsTotal">-</div>
                <div class="metric-subtitle">
                  Êñ∞Â¢û <span id="businessConsultationsNew">-</span> ‰∫∫
                </div>
                <div class="metric-delta" id="businessConsultationsDelta">-</div>
              </article>

              <article class="metric-card" style="border: 1px solid rgba(168, 85, 247, 0.3);">
                <div class="metric-label">È¢ÑÁ∫¶Èù¢ËØïÊ¨°Êï∞</div>
                <div class="metric-value" id="businessBookingAttempts">-</div>
                <div class="metric-subtitle">
                  ÊàêÂäü <span id="businessBookingSuccessful" style="color: var(--success);">-</span> /
                  Â§±Ë¥• <span id="businessBookingFailed" style="color: var(--danger);">-</span>
                </div>
                <div class="metric-delta" id="businessBookingAttemptsDelta">-</div>
              </article>

              <article class="metric-card success" style="border: 1px solid rgba(16, 185, 129, 0.3);">
                <div class="metric-label">È¢ÑÁ∫¶ÊàêÂäüÁéá</div>
                <div class="metric-value" id="businessBookingSuccessRate">-</div>
                <div class="metric-subtitle">
                  Âí®ËØ¢ËΩ¨ÂåñÁéá <span id="businessConversionRate">-</span>
                </div>
                <div class="metric-delta" id="businessBookingSuccessRateDelta">-</div>
              </article>
            </section>

            <!-- Ë∂ãÂäøÂõæË°® -->
            <section class="charts-row">
              <div class="chart-card">
                <div class="chart-header">
                  <div>
                    <h3>Âí®ËØ¢‰∫∫Êï∞Ë∂ãÂäø</h3>
                    <p>Ê¥ªË∑ÉÁî®Êà∑Êï∞ÈáèÂèòÂåñ</p>
                  </div>
                </div>
                <div class="chart-container">
                  <canvas id="consultationsTrendChart"></canvas>
                </div>
              </div>
              <div class="chart-card">
                <div class="chart-header">
                  <div>
                    <h3>È¢ÑÁ∫¶ËΩ¨ÂåñË∂ãÂäø</h3>
                    <p>È¢ÑÁ∫¶Ê¨°Êï∞‰∏éÊàêÂäüÁéá</p>
                  </div>
                </div>
                <div class="chart-container">
                  <canvas id="bookingTrendChart"></canvas>
                </div>
              </div>
            </section>

          </div>

          <!-- Page: System (Á≥ªÁªüÁõëÊéß) -->
          <div id="page-system" class="page-section">
            <!-- ËøêÁª¥Ê¥ûÂØü -->
            <section class="insight-grid">
              <article class="insight-card">
                <div class="insight-title">üõ∑ ÊéíÈòü‰∏éÂìçÂ∫î</div>
                <div class="insight-metrics">
                  <div>
                    <span>ÂÆûÊó∂Â§ÑÁêÜ‰∏≠</span>
                    <strong id="queueCurrent">-</strong>
                  </div>
                  <div>
                    <span>Â≥∞ÂÄºÈòüÂàó</span>
                    <strong id="queuePeak">-</strong>
                  </div>
                  <div>
                    <span>Âπ≥ÂùáÁ≠âÂæÖ</span>
                    <strong id="queueAvgWait">-</strong>
                  </div>
                </div>
              </article>
              <article class="insight-card">
                <div class="insight-title">üï∞Ô∏è Âª∂ËøüÂàÜÂ∏É</div>
                <div class="percentiles">
                  <div>
                    <span>P50</span>
                    <strong id="p50Duration">-</strong>
                  </div>
                  <div>
                    <span>P95</span>
                    <strong id="p95Duration">-</strong>
                  </div>
                  <div>
                    <span>P99</span>
                    <strong id="p99Duration">-</strong>
                  </div>
                </div>
              </article>
              <article class="insight-card">
                <div class="insight-title">üîî ÂëäË≠¶Ê¶ÇËßà</div>
                <div class="insight-metrics">
                  <div>
                    <span>Á¥ØËÆ°</span>
                    <strong id="alertTotal">-</strong>
                  </div>
                  <div>
                    <span>Ëøë24Â∞èÊó∂</span>
                    <strong id="alertRecent">-</strong>
                  </div>
                </div>
              </article>
              <article class="insight-card">
                <div class="insight-title">üìú ÂëäË≠¶Á±ªÂûãÂàÜÂ∏É</div>
                <div id="alertTypeList" class="alert-type-list">
                  <div class="loading" style="padding: 12px 0; font-size: 13px;">ÊöÇÊó†Êï∞ÊçÆ</div>
                </div>
              </article>
            </section>

            <!-- ÊØèÊó•Ë∂ãÂäø -->
            <section class="charts-row">
              <div class="chart-card">
                <div class="chart-header">
                  <div>
                    <h3>ÊØèÊó• Token Ê∂àËÄó</h3>
                    <p>ÊúÄËøë 7 Â§©‰ΩøÁî®Èáè</p>
                  </div>
                  <div class="chart-kpi">
                    <span>‰ªäÊó•Ê∂àËÄó</span>
                    <strong id="dailyTokenUsage">-</strong>
                  </div>
                </div>
                <canvas id="dailyTokenChart"></canvas>
              </div>
              <div class="chart-card">
                <div class="chart-header">
                  <div>
                    <h3>ÊØèÊó•Âí®ËØ¢‰∫∫Êï∞</h3>
                    <p>ÊúÄËøë 7 Â§©ÂîØ‰∏ÄÁî®Êà∑</p>
                  </div>
                  <div class="chart-kpi">
                    <span>‰ªäÊó•‰∫∫Êï∞</span>
                    <strong id="dailyUserCount">-</strong>
                  </div>
                </div>
                <canvas id="dailyUserChart"></canvas>
              </div>
            </section>

            <!-- ÂÆûÊó∂ÊÄßËÉΩ -->
            <section class="charts-row">
              <div class="chart-card">
                <div class="chart-header">
                  <div>
                    <h3>ÂìçÂ∫îËÄóÊó∂</h3>
                    <p>ÊúÄËøë <span id="chartRangeLabel">60</span> ÂàÜÈíü</p>
                  </div>
                  <div class="chart-kpi">
                    <span>ÂΩìÂâçÂπ≥Âùá</span>
                    <strong id="responseChartAvg">-</strong>
                  </div>
                </div>
                <canvas id="responseTrendChart"></canvas>
              </div>
              <div class="chart-card">
                <div class="chart-header">
                  <div>
                    <h3>ÂëäË≠¶Ë∂ãÂäø</h3>
                    <p>ÊúÄËøë 60 ÂàÜÈíü</p>
                  </div>
                  <div class="chart-kpi">
                    <span>Ëøë5ÂàÜÈíü</span>
                    <strong id="alertTrendRecent">-</strong>
                  </div>
                </div>
                <canvas id="alertTrendChart"></canvas>
              </div>
            </section>

            <!-- ÊúÄÊÖ¢ËÆ∞ÂΩï -->
            <section class="section">
              <div class="section-header">
                <h3>ÊúÄÊÖ¢ËÆ∞ÂΩï (Top 10)</h3>
              </div>
              <div class="table-wrapper">
                <table>
                  <thead>
                    <tr>
                      <th>Êó∂Èó¥</th>
                      <th>Áî®Êà∑</th>
                      <th>Ê∂àÊÅØÈ¢ÑËßà</th>
                      <th>ÊÄªËÄóÊó∂</th>
                      <th>AI ËÄóÊó∂</th>
                      <th>ÂõûÂ§çÊù°Êï∞</th>
                      <th>Áä∂ÊÄÅ</th>
                    </tr>
                  </thead>
                  <tbody id="slowestRecords">
                    <tr>
                      <td colspan="7" class="loading">Âä†ËΩΩ‰∏≠</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </section>
          </div>

          <!-- Page: Users (Áî®Êà∑ÁÆ°ÁêÜ) -->
          <div id="page-users" class="page-section">
            <!-- Áî®Êà∑ÂàóË°® -->
            <section class="section">
              <div class="section-header">
                <h3>‰ªäÊó•Âí®ËØ¢Áî®Êà∑ <span id="todayUserCount" style="font-size: 14px; color: var(--text-secondary); font-weight: normal;">(0 ‰∫∫)</span></h3>
              </div>
              <div class="table-wrapper">
                <table>
                  <thead>
                    <tr>
                      <th>Áî®Êà∑</th>
                      <th>‰ºöËØù</th>
                      <th>Ê∂àÊÅØÊï∞</th>
                      <th>Token Ê∂àËÄó</th>
                      <th>È¶ñÊ¨°Ê¥ªË∑É</th>
                      <th>ÊúÄÂêéÊ¥ªË∑É</th>
                      <th>ÊâòÁÆ°Áä∂ÊÄÅ</th>
                    </tr>
                  </thead>
                  <tbody id="todayUsersList">
                    <tr>
                      <td colspan="7" class="loading">Âä†ËΩΩ‰∏≠</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </section>
          </div>

          <!-- Page: Logs (Ê∂àÊÅØÊó•Âøó) -->
          <div id="page-logs" class="page-section">
            <!-- ÂÆûÊó∂Ê∂àÊÅØ -->
            <section class="section">
              <div class="section-header">
                <h3>ÂÆûÊó∂Ê∂àÊÅØ <span id="recentMessagesTotal" style="font-size: 14px; color: var(--text-secondary); font-weight: normal;">(0 Êù°)</span></h3>
              </div>
              <div class="table-wrapper">
                <table>
                  <thead>
                    <tr>
                      <th>Êó∂Èó¥</th>
                      <th>Áî®Êà∑</th>
                      <th>Áî®Êà∑Ê∂àÊÅØ</th>
                      <th>ÂõûÂ§çÈ¢ÑËßà</th>
                      <th>ÊÄªËÄóÊó∂</th>
                      <th>Áä∂ÊÄÅ</th>
                    </tr>
                  </thead>
                  <tbody id="recentMessages">
                    <tr>
                      <td colspan="6" class="loading">Âä†ËΩΩ‰∏≠</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </section>
          </div>

          <div class="page-footnote">
            <button class="btn btn-ghost danger-link" type="button" onclick="clearData()">Ê∏ÖÁ©∫ÁõëÊéßÊï∞ÊçÆ</button>
            <span>‰ªÖÂú®ÈúÄË¶ÅÈáçÁΩÆÁªüËÆ°Êó∂‰ΩøÁî®</span>
          </div>
        </div>
      </main>
    </div>

    <script>
      let autoRefreshInterval = null;
      let responseTrendChart = null;
      let alertTrendChart = null;
      let consultationsTrendChart = null;
      let bookingTrendChart = null;
      let dailyTokenChart = null;
      let dailyUserChart = null;
      let cachedDashboard = null;
      let cachedMetrics = null;
      let currentTimeRange = 'today';
      let pausedUsersCache = new Set();

      // Ê∂àÊÅØÂàóË°®
      let allRecentMessages = [];
      const MAX_MESSAGES = 50; // ÊúÄÂ§öÊòæÁ§∫50Êù°

      function switchPage(pageId) {
        // Update Menu
        document.querySelectorAll('.nav-item').forEach(el => {
          el.classList.remove('active');
        });
        const navItem = document.getElementById(`nav-${pageId}`);
        if (navItem) navItem.classList.add('active');

        // Update Page
        document.querySelectorAll('.page-section').forEach(el => {
          el.classList.remove('active');
        });
        const pageSection = document.getElementById(`page-${pageId}`);
        if (pageSection) pageSection.classList.add('active');

        // Trigger chart resize
        setTimeout(() => {
          window.dispatchEvent(new Event('resize'));
        }, 50);
      }

      const unwrapResponse = (payload) => {
        let current = payload;
        while (current && typeof current === 'object' && 'data' in current) {
          current = current.data;
        }
        return current;
      };

      document.addEventListener('DOMContentLoaded', () => {
        initCharts();
        setupAutoRefreshToggle();
        setupAiReplyToggle();
        setupTimeRangeFilters();
        refreshAll();
        loadAiReplyStatus();

        // ÈªòËÆ§ÊòæÁ§∫‰ª™Ë°®ÁõòÈ°µÈù¢
        switchPage('dashboard');
      });

      async function refreshAll() {
        await Promise.all([refreshHealthStatus(), refreshDashboard()]);
      }

      function setupAutoRefreshToggle() {
        const checkbox = document.getElementById('autoRefresh');
        checkbox.addEventListener('change', toggleAutoRefresh);
        toggleAutoRefresh();
      }

      function toggleAutoRefresh() {
        const checkbox = document.getElementById('autoRefresh');
        if (checkbox.checked) {
          if (autoRefreshInterval) clearInterval(autoRefreshInterval);
          autoRefreshInterval = setInterval(refreshDashboard, 5000);
        } else if (autoRefreshInterval) {
          clearInterval(autoRefreshInterval);
          autoRefreshInterval = null;
        }
      }

      function setupAiReplyToggle() {
        const checkbox = document.getElementById('aiReplyToggle');
        checkbox.addEventListener('change', handleAiReplyToggle);
      }

      async function loadAiReplyStatus() {
        try {
          const response = await fetch('/monitoring/ai-reply-status');
          const result = await response.json();
          const payload = unwrapResponse(result);
          updateAiReplyUI(payload?.enabled ?? false);
        } catch (error) {
          console.error('Ëé∑Âèñ AI ÂõûÂ§çÁä∂ÊÄÅÂ§±Ë¥•', error);
        }
      }

      async function handleAiReplyToggle() {
        const checkbox = document.getElementById('aiReplyToggle');
        const enabled = checkbox.checked;

        try {
          checkbox.disabled = true;
          const response = await fetch('/monitoring/toggle-ai-reply', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ enabled }),
          });

          const result = await response.json();
          const responseData = unwrapResponse(result);
          updateAiReplyUI(responseData?.enabled ?? enabled);

          // ÊòæÁ§∫ÈÄöÁü•
          console.log(responseData?.message || 'Áä∂ÊÄÅÂ∑≤Êõ¥Êñ∞');
        } catch (error) {
          console.error('ÂàáÊç¢ AI ÂõûÂ§çÁä∂ÊÄÅÂ§±Ë¥•', error);
          // ÊÅ¢Â§çÂéüÊù•ÁöÑÁä∂ÊÄÅ
          checkbox.checked = !enabled;
        } finally {
          checkbox.disabled = false;
        }
      }

      function updateAiReplyUI(enabled) {
        const checkbox = document.getElementById('aiReplyToggle');
        const statusText = document.getElementById('aiReplyStatus');

        checkbox.checked = enabled;
        statusText.textContent = enabled ? 'Â∑≤ÂêØÁî®' : 'Â∑≤Á¶ÅÁî®';
        statusText.className = enabled ? 'status-text enabled' : 'status-text disabled';
      }

      function setupTimeRangeFilters() {
        const filterButtons = document.querySelectorAll('.filters button[data-range]');
        filterButtons.forEach(button => {
          button.addEventListener('click', () => {
            filterButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            currentTimeRange = button.dataset.range;
            refreshDashboard();
          });
        });
      }

      async function refreshDashboard() {
        try {
          const [dashboardRes, metricsRes] = await Promise.all([
            fetch(`/monitoring/dashboard?range=${currentTimeRange}`),
            fetch('/monitoring/metrics'),
          ]);
          const dashboardPayload = await dashboardRes.json();
          const metricsPayload = await metricsRes.json();
          const dashboard = unwrapResponse(dashboardPayload);
          const metrics = unwrapResponse(metricsPayload);
          cachedDashboard = dashboard;
          cachedMetrics = metrics;
          renderDashboard(dashboard, metrics);
          document.getElementById('lastUpdate').textContent = formatTime(Date.now());
        } catch (error) {
          console.error('Âä†ËΩΩÁõëÊéßÊï∞ÊçÆÂ§±Ë¥•', error);
        }
      }

      function renderDashboard(dashboard, metrics) {
        updateTimeRangeBadge(dashboard.timeRange);
        updateOverview(dashboard);
        updateFallbackStats(dashboard.fallback, dashboard.fallbackDelta);
        updateBusinessMetrics(dashboard.business, dashboard.businessDelta);
        updateQueueInfo(dashboard);
        updatePercentiles(metrics.percentiles);
        updateSlowestTable(metrics.slowestRecords);
        updateRecentMessages(dashboard.recentMessages);
        updateCharts(dashboard);
        updateDailyCharts(dashboard.dailyTrend);
        updateTodayUsersList(dashboard.todayUsers);
      }

      function updateOverview(data) {
        const { overview, overviewDelta } = data;
        setMetric('totalMessages', overview.totalMessages);
        setMetric('successRate', `${overview.successRate.toFixed(1)}%`);
        setMetric('avgDuration', formatDuration(overview.avgDuration));
        setMetric('activeUsers', overview.activeUsers);
        document.getElementById('successCount').textContent = `ÊàêÂäü ${overview.successCount} Êù°`;
        document.getElementById('activeChats').textContent = `${overview.activeChats} ‰∏™‰ºöËØù`;
        setDelta('totalMessagesDelta', overviewDelta.totalMessages);
        setDelta('successRateDelta', overviewDelta.successRate);
        setDelta('avgDurationDelta', overviewDelta.avgDuration);
        setDelta('activeUsersDelta', overviewDelta.activeUsers);
      }

      function setMetric(id, value) {
        const el = document.getElementById(id);
        if (el) {
          el.textContent = value ?? '-';
        }
      }

      function setDelta(id, delta) {
        const el = document.getElementById(id);
        if (!el || delta === undefined || delta === null) {
          return;
        }
        const val = parseFloat(delta.toFixed(1));
        el.textContent = `${val >= 0 ? '+' : ''}${val}%`;
        el.classList.toggle('positive', val >= 0);
        el.classList.toggle('negative', val < 0);
      }

      function updateQueueInfo(data) {
        const queue = data.queue || {};
        document.getElementById('queueCurrent').textContent = queue.currentProcessing ?? '-';
        document.getElementById('queuePeak').textContent = queue.peakProcessing ?? '-';
        document.getElementById('queueAvgWait').textContent = queue.avgQueueDuration
          ? formatDuration(queue.avgQueueDuration)
          : '-';
        const alerts = data.alertsSummary || { total: 0, last24Hours: 0, byType: [] };
        document.getElementById('alertTotal').textContent = alerts.total;
        document.getElementById('alertRecent').textContent = alerts.last24Hours;
        updateAlertTypeList(alerts.byType || []);
      }

      function updateAlertTypeList(alertTypes) {
        const container = document.getElementById('alertTypeList');
        if (!alertTypes || alertTypes.length === 0) {
          container.innerHTML = '<div class="loading" style="padding: 12px 0; font-size: 13px;">ÊöÇÊó†Êï∞ÊçÆ</div>';
          return;
        }

        const typeLabels = {
          agent: 'AI ‰ª£ÁêÜ',
          message: 'Ê∂àÊÅØÂ§ÑÁêÜ',
          delivery: 'Ê∂àÊÅØÂèëÈÄÅ',
          merge: 'Ê∂àÊÅØÂêàÂπ∂',
          unknown: 'Êú™Áü•Á±ªÂûã',
        };

        const typeIcons = {
          agent: 'ü§ñ',
          message: 'üí¨',
          delivery: 'üì§',
          merge: 'üîÄ',
          unknown: '‚ùì',
        };

        container.innerHTML = alertTypes
          .map(
            (item) => `
          <div class="alert-type-item">
            <div class="alert-type-label">
              <span class="alert-type-badge ${item.type}">${typeIcons[item.type] || '‚ùì'}</span>
              <span>${typeLabels[item.type] || item.type}</span>
            </div>
            <div class="alert-type-bar">
              <div class="alert-type-bar-fill ${item.type}" style="width: ${item.percentage}%"></div>
            </div>
            <div class="alert-type-stats">
              <span class="alert-type-count">${item.count}</span>
              <span class="alert-type-percentage">${item.percentage}%</span>
            </div>
          </div>
        `,
          )
          .join('');
      }

      function updateTimeRangeBadge(timeRange) {
        const badge = document.getElementById('timeRangeBadge');
        const businessBadge = document.getElementById('businessTimeRangeBadge');
        const labels = {
          'today': 'ÔºàÊú¨Êó•Ôºâ',
          'week': 'ÔºàÊú¨Âë®Ôºâ',
          'month': 'ÔºàÊú¨ÊúàÔºâ'
        };
        const label = labels[timeRange] || '';
        badge.textContent = label;
        if (businessBadge) {
          businessBadge.textContent = label;
        }
      }

      function updateFallbackStats(fallback, fallbackDelta) {
        if (!fallback) return;
        document.getElementById('fallbackCount').textContent = fallback.totalCount;
        document.getElementById('fallbackRate').textContent =
          `ÊàêÂäüÁéá ${fallback.successRate.toFixed(1)}% (${fallback.successCount}/${fallback.totalCount})`;
        setDelta('fallbackDelta', fallbackDelta.totalCount);
      }

      function updateBusinessMetrics(business, businessDelta) {
        if (!business) return;

        // ÊÄªÂí®ËØ¢‰∫∫Êï∞
        document.getElementById('businessConsultationsTotal').textContent = business.consultations.total;
        document.getElementById('businessConsultationsNew').textContent = business.consultations.new;
        setDelta('businessConsultationsDelta', businessDelta.consultations);

        // È¢ÑÁ∫¶Èù¢ËØïÊ¨°Êï∞
        document.getElementById('businessBookingAttempts').textContent = business.bookings.attempts;
        document.getElementById('businessBookingSuccessful').textContent = business.bookings.successful;
        document.getElementById('businessBookingFailed').textContent = business.bookings.failed;
        setDelta('businessBookingAttemptsDelta', businessDelta.bookingAttempts);

        // È¢ÑÁ∫¶ÊàêÂäüÁéá
        document.getElementById('businessBookingSuccessRate').textContent =
          business.bookings.successRate > 0 ? `${business.bookings.successRate.toFixed(1)}%` : '0%';
        document.getElementById('businessConversionRate').textContent =
          business.conversion.consultationToBooking > 0
            ? `${business.conversion.consultationToBooking.toFixed(1)}%`
            : '0%';
        setDelta('businessBookingSuccessRateDelta', businessDelta.bookingSuccessRate);
      }

      function updatePercentiles(percentiles) {
        if (!percentiles) return;
        document.getElementById('p50Duration').textContent = formatDuration(percentiles.p50);
        document.getElementById('p95Duration').textContent = formatDuration(percentiles.p95);
        document.getElementById('p99Duration').textContent = formatDuration(percentiles.p99);
      }

      function updateSlowestTable(records) {
        const tbody = document.getElementById('slowestRecords');
        tbody.innerHTML = '';
        if (!records || records.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7" class="loading">ÊöÇÊó†Êï∞ÊçÆ</td></tr>';
          return;
        }
        records.forEach((record) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${formatTime(record.receivedAt)}</td>
            <td>${record.userName || record.chatId}</td>
            <td>${record.messagePreview || '-'}</td>
            <td>${formatDuration(record.totalDuration)}</td>
            <td>${formatDuration(record.aiDuration)}</td>
            <td>${record.replySegments ?? '-'}</td>
            <td><span class="status-badge ${record.status === 'success' ? 'success' : 'danger'}">${record.status}</span></td>
          `;
          tbody.appendChild(row);
        });
      }

      function updateRecentMessages(records) {
        // Â≠òÂÇ®ËÆ∞ÂΩïÔºàÊúÄÂ§ö50Êù°Ôºâ
        allRecentMessages = (records || []).slice(0, MAX_MESSAGES);

        // Êõ¥Êñ∞ÊÄªÊï∞ÊòæÁ§∫
        document.getElementById('recentMessagesTotal').textContent = `(${allRecentMessages.length} Êù°)`;

        // Ê∏≤ÊüìÊ∂àÊÅØÂàóË°®
        renderMessages();
      }

      function renderMessages() {
        const tbody = document.getElementById('recentMessages');
        tbody.innerHTML = '';

        if (!allRecentMessages || allRecentMessages.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" class="loading">ÊöÇÊó†Êï∞ÊçÆ</td></tr>';
          return;
        }

        // Áõ¥Êé•Ê∏≤ÊüìÊâÄÊúâÊï∞ÊçÆÔºàÊúÄÂ§ö50Êù°Ôºâ
        allRecentMessages.forEach((record) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${formatTime(record.receivedAt)}</td>
            <td>${record.userName || record.chatId || '-'}</td>
            <td>${record.messagePreview || '-'}</td>
            <td>${record.replyPreview || '-'}</td>
            <td>${formatDuration(record.totalDuration)}</td>
            <td><span class="status-badge ${
              record.status === 'success'
                ? 'success'
                : record.status === 'failure'
                ? 'danger'
                : 'warning'
            }">${record.status}</span></td>
          `;
          tbody.appendChild(row);
        });
      }

      function createGradient(ctx, colorStart, colorEnd) {
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, colorStart);
        gradient.addColorStop(1, colorEnd);
        return gradient;
      }

      function initCharts() {
        Chart.defaults.font.family = "'Inter', system-ui, -apple-system, sans-serif";
        Chart.defaults.color = '#64748b'; // Darker text for light mode
        Chart.defaults.scale.grid.color = 'rgba(0, 0, 0, 0.05)'; // Darker grid lines
        Chart.defaults.scale.grid.borderColor = 'transparent';

        const commonOptions = {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false,
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(255, 255, 255, 0.95)', // Light tooltip
              titleColor: '#1e293b', // Dark title
              bodyColor: '#475569', // Dark body
              borderColor: 'rgba(148, 163, 184, 0.2)',
              borderWidth: 1,
              padding: 12,
              cornerRadius: 8,
              displayColors: false,
              callbacks: {
                label: (context) => `${context.dataset.label}: ${context.parsed.y}`
              }
            }
          },
          scales: {
            x: {
              grid: { display: false },
              ticks: { color: '#94a3b8', font: { size: 11 } },
            },
            y: {
              beginAtZero: true,
              border: { display: false },
              grid: { color: 'rgba(0, 0, 0, 0.03)' },
              ticks: { color: '#94a3b8', font: { size: 11 }, padding: 10 },
            },
          },
          elements: {
            line: { tension: 0.4, borderWidth: 3 },
            point: { radius: 0, hoverRadius: 6, borderWidth: 2, hoverBorderWidth: 3 }
          }
        };

        // ÂìçÂ∫îËÄóÊó∂Ë∂ãÂäøÂõæË°® - Âú£ËØûÁªø
        const responseCtx = document.getElementById('responseTrendChart').getContext('2d');
        const responseGradient = createGradient(responseCtx, 'rgba(16, 185, 129, 0.2)', 'rgba(16, 185, 129, 0)');
        
        responseTrendChart = new Chart(responseCtx, {
          type: 'line',
          data: {
            labels: [],
            datasets: [{
              label: 'Âπ≥ÂùáËÄóÊó∂ (Áßí)',
              data: [],
              borderColor: '#10b981', // Christmas Green
              backgroundColor: responseGradient,
              fill: true,
              pointBackgroundColor: '#ffffff',
              pointBorderColor: '#10b981',
              pointRadius: 4,
              pointHoverRadius: 6,
            }],
          },
          options: {
            ...commonOptions,
            scales: {
              ...commonOptions.scales,
              y: {
                ...commonOptions.scales.y,
                ticks: { callback: (value) => `${value.toFixed(1)}s` }
              }
            }
          }
        });

        // ÂëäË≠¶Ë∂ãÂäøÂõæË°® - Âú£ËØûÁ∫¢
        const alertCtx = document.getElementById('alertTrendChart').getContext('2d');
        alertTrendChart = new Chart(alertCtx, {
          type: 'bar',
          data: {
            labels: [],
            datasets: [{
              label: 'ÂëäË≠¶Ê¨°Êï∞',
              data: [],
              backgroundColor: '#ef4444', // Christmas Red
              borderRadius: 6,
              hoverBackgroundColor: '#dc2626',
            }],
          },
          options: {
            ...commonOptions,
            scales: {
              ...commonOptions.scales,
              y: {
                ...commonOptions.scales.y,
                ticks: { stepSize: 1, precision: 0 }
              }
            }
          }
        });

        // Âí®ËØ¢‰∫∫Êï∞Ë∂ãÂäøÂõæË°® - ÂÜ∞Èõ™Ëìù
        const consultationsCtx = document.getElementById('consultationsTrendChart').getContext('2d');
        const consultGradient = createGradient(consultationsCtx, 'rgba(59, 130, 246, 0.2)', 'rgba(59, 130, 246, 0)');

        consultationsTrendChart = new Chart(consultationsCtx, {
          type: 'line',
          data: {
            labels: [],
            datasets: [{
              label: 'Âí®ËØ¢‰∫∫Êï∞',
              data: [],
              borderColor: '#3b82f6', // Ice Blue
              backgroundColor: consultGradient,
              fill: true,
              pointBackgroundColor: '#ffffff',
              pointBorderColor: '#3b82f6',
              pointRadius: 4,
              pointHoverRadius: 6,
            }],
          },
          options: {
            ...commonOptions,
            scales: {
              ...commonOptions.scales,
              y: {
                ...commonOptions.scales.y,
                ticks: { stepSize: 1, precision: 0 }
              }
            }
          }
        });

        // È¢ÑÁ∫¶ËΩ¨ÂåñË∂ãÂäøÂõæË°®ÔºàÂèåËΩ¥Ôºâ- Á∫¢Ëâ≤ & ÁªøËâ≤
        const bookingCtx = document.getElementById('bookingTrendChart').getContext('2d');
        const bookingGradient = createGradient(bookingCtx, 'rgba(239, 68, 68, 0.2)', 'rgba(239, 68, 68, 0)');

        bookingTrendChart = new Chart(bookingCtx, {
          type: 'line',
          data: {
            labels: [],
            datasets: [
              {
                label: 'È¢ÑÁ∫¶Ê¨°Êï∞',
                data: [],
                borderColor: '#ef4444', // Red
                backgroundColor: bookingGradient,
                fill: true,
                yAxisID: 'y',
                pointBackgroundColor: '#ffffff',
                pointBorderColor: '#ef4444',
                pointRadius: 4,
                pointHoverRadius: 6,
              },
              {
                label: 'È¢ÑÁ∫¶ÊàêÂäüÁéá',
                data: [],
                borderColor: '#10b981', // Green
                backgroundColor: 'transparent',
                borderDash: [5, 5],
                fill: false,
                yAxisID: 'y1',
                pointBackgroundColor: '#ffffff',
                pointBorderColor: '#10b981',
                pointRadius: 4,
                pointHoverRadius: 6,
              },
            ],
          },
          options: {
            ...commonOptions,
            plugins: {
              ...commonOptions.plugins,
              legend: {
                display: true,
                labels: { color: '#6b7280', usePointStyle: true, boxWidth: 8 }
              }
            },
            scales: {
              x: commonOptions.scales.x,
              y: {
                ...commonOptions.scales.y,
                position: 'left',
                title: { display: true, text: 'È¢ÑÁ∫¶Ê¨°Êï∞', color: '#ef4444', font: {size: 10} }
              },
              y1: {
                ...commonOptions.scales.y,
                position: 'right',
                grid: { drawOnChartArea: false },
                title: { display: true, text: 'ÊàêÂäüÁéá (%)', color: '#10b981', font: {size: 10} },
                ticks: { callback: (value) => `${value}%` }
              },
            },
          },
        });

        // ÊØèÊó• Token Ê∂àËÄóË∂ãÂäøÂõæË°® - Âú£ËØûÈáë
        const dailyTokenCtx = document.getElementById('dailyTokenChart').getContext('2d');
        dailyTokenChart = new Chart(dailyTokenCtx, {
          type: 'bar',
          data: {
            labels: [],
            datasets: [{
              label: 'Token Ê∂àËÄó',
              data: [],
              backgroundColor: '#f59e0b', // Gold
              borderRadius: 6,
              hoverBackgroundColor: '#d97706',
            }],
          },
          options: {
            ...commonOptions,
            scales: {
              ...commonOptions.scales,
              y: {
                ...commonOptions.scales.y,
                ticks: { callback: (value) => value >= 1000 ? `${(value / 1000).toFixed(1)}k` : value }
              }
            }
          }
        });

        // ÊØèÊó•Áî®Êà∑Êï∞Ë∂ãÂäøÂõæË°® - Âú£ËØûÁªø
        const dailyUserCtx = document.getElementById('dailyUserChart').getContext('2d');
        const userGradient = createGradient(dailyUserCtx, 'rgba(16, 185, 129, 0.2)', 'rgba(16, 185, 129, 0)');

        dailyUserChart = new Chart(dailyUserCtx, {
          type: 'line',
          data: {
            labels: [],
            datasets: [{
              label: 'Âí®ËØ¢‰∫∫Êï∞',
              data: [],
              borderColor: '#10b981', // Green
              backgroundColor: userGradient,
              fill: true,
              pointBackgroundColor: '#ffffff',
              pointBorderColor: '#10b981',
              pointRadius: 4,
              pointHoverRadius: 6,
            }],
          },
          options: {
            ...commonOptions,
            scales: {
              ...commonOptions.scales,
              y: {
                ...commonOptions.scales.y,
                ticks: { stepSize: 1, precision: 0 }
              }
            }
          }
        });
      }

      function updateCharts(data) {
        const isToday = currentTimeRange === 'today';
        const formatLabel = isToday ? formatMinuteLabel : formatDayLabel;

        // Êú¨Êó•ÔºöÊòæÁ§∫ÊúÄËøë90‰∏™Êï∞ÊçÆÁÇπÔºõÊú¨Âë®/Êú¨ÊúàÔºöÊòæÁ§∫ÂÖ®ÈÉ®Êï∞ÊçÆÁÇπ
        const responsePoints = isToday
          ? (data.responseTrend || []).slice(-90)
          : (data.responseTrend || []);
        const responseLabels = responsePoints.map((point) => formatLabel(point.minute));
        responseTrendChart.data.labels = responseLabels;
        responseTrendChart.data.datasets[0].data = responsePoints.map((point) =>
          point.avgDuration ? point.avgDuration / 1000 : 0,
        );
        responseTrendChart.update();

        // Êõ¥Êñ∞ÂõæË°®ËåÉÂõ¥Ê†áÁ≠æ
        const rangeText = isToday
          ? `${responseLabels.length} ÂàÜÈíü`
          : `${responseLabels.length} Â§©`;
        document.getElementById('chartRangeLabel').textContent = responseLabels.length;
        document.getElementById('responseChartAvg').textContent =
          responsePoints.length > 0
            ? formatDuration(responsePoints[responsePoints.length - 1].avgDuration)
            : '-';

        const alertPoints = isToday
          ? (data.alertTrend || []).slice(-90)
          : (data.alertTrend || []);
        const alertLabels = alertPoints.map((point) => formatLabel(point.minute));
        alertTrendChart.data.labels = alertLabels;
        alertTrendChart.data.datasets[0].data = alertPoints.map((point) => point.count);
        alertTrendChart.update();
        const lastFiveAlerts = alertPoints.slice(-5).reduce((sum, point) => sum + point.count, 0);
        document.getElementById('alertTrendRecent').textContent = lastFiveAlerts || 0;

        // Êõ¥Êñ∞‰∏öÂä°ÊåáÊ†áË∂ãÂäøÂõæË°®
        const businessPoints = isToday
          ? (data.businessTrend || []).slice(-90)
          : (data.businessTrend || []);
        const businessLabels = businessPoints.map((point) => formatLabel(point.minute));

        // Âí®ËØ¢‰∫∫Êï∞Ë∂ãÂäø
        consultationsTrendChart.data.labels = businessLabels;
        consultationsTrendChart.data.datasets[0].data = businessPoints.map(
          (point) => point.consultations,
        );
        consultationsTrendChart.update();

        // È¢ÑÁ∫¶ËΩ¨ÂåñË∂ãÂäøÔºàÂèåËΩ¥ÔºöÈ¢ÑÁ∫¶Ê¨°Êï∞ + ÊàêÂäüÁéáÔºâ
        bookingTrendChart.data.labels = businessLabels;
        bookingTrendChart.data.datasets[0].data = businessPoints.map(
          (point) => point.bookingAttempts,
        );
        bookingTrendChart.data.datasets[1].data = businessPoints.map(
          (point) => point.bookingSuccessRate,
        );
        bookingTrendChart.update();
      }

      function updateDailyCharts(dailyTrend) {
        if (!dailyTrend || dailyTrend.length === 0) {
          document.getElementById('dailyTokenUsage').textContent = '-';
          document.getElementById('dailyUserCount').textContent = '-';
          return;
        }

        // Ê†ºÂºèÂåñÊó•ÊúüÊ†áÁ≠æ‰∏∫ MM-DD
        const labels = dailyTrend.map(day => {
          const date = day.date;
          return date.substring(5); // "2025-11-21" -> "11-21"
        });

        // Êõ¥Êñ∞ Token Ê∂àËÄóÂõæË°®
        dailyTokenChart.data.labels = labels;
        dailyTokenChart.data.datasets[0].data = dailyTrend.map(day => day.tokenUsage);
        dailyTokenChart.update();

        // Êõ¥Êñ∞Áî®Êà∑Êï∞ÂõæË°®
        dailyUserChart.data.labels = labels;
        dailyUserChart.data.datasets[0].data = dailyTrend.map(day => day.uniqueUsers);
        dailyUserChart.update();

        // Êõ¥Êñ∞ KPI ÊòæÁ§∫Ôºà‰ªäÊó•Êï∞ÊçÆÔºâ
        const today = dailyTrend[dailyTrend.length - 1];
        document.getElementById('dailyTokenUsage').textContent =
          today.tokenUsage >= 1000
            ? `${(today.tokenUsage / 1000).toFixed(1)}k`
            : today.tokenUsage.toLocaleString();
        document.getElementById('dailyUserCount').textContent = `${today.uniqueUsers} ‰∫∫`;
      }

      function updateTodayUsersList(users) {
        const tbody = document.getElementById('todayUsersList');
        const countSpan = document.getElementById('todayUserCount');

        if (!users || users.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7" class="loading">ÊöÇÊó†‰ªäÊó•Âí®ËØ¢Áî®Êà∑</td></tr>';
          countSpan.textContent = '(0 ‰∫∫)';
          return;
        }

        countSpan.textContent = `(${users.length} ‰∫∫)`;

        tbody.innerHTML = users.map(user => {
          const isPaused = user.isPaused;
          const statusBadge = isPaused
            ? '<span class="status-badge warning">Â∑≤ÊöÇÂÅú</span>'
            : '<span class="status-badge success">ÊâòÁÆ°‰∏≠</span>';
          const toggleBtn = isPaused
            ? `<button class="btn btn-ghost" style="padding: 4px 8px; font-size: 11px;" onclick="toggleUserHosting('${user.chatId}', false)">ÊÅ¢Â§ç</button>`
            : `<button class="btn btn-ghost" style="padding: 4px 8px; font-size: 11px; color: var(--warning);" onclick="toggleUserHosting('${user.chatId}', true)">ÊöÇÂÅú</button>`;

          // ÊòæÁ§∫Â∞èÁªÑ‰ø°ÊÅØÔºàÂ¶ÇÊûúÊúâÔºâ
          const groupInfo = user.groupName ? `<br><span style="font-size: 11px; color: var(--text-muted);">${user.groupName}</span>` : '';

          return `
            <tr>
              <td>
                <strong>${user.odName || user.odId}</strong>
                ${groupInfo}
              </td>
              <td style="font-size: 11px; color: var(--text-muted);">${user.chatId.substring(0, 8)}...</td>
              <td>${user.messageCount}</td>
              <td>${user.tokenUsage >= 1000 ? `${(user.tokenUsage / 1000).toFixed(1)}k` : user.tokenUsage}</td>
              <td>${formatTime(user.firstActiveAt)}</td>
              <td>${formatTime(user.lastActiveAt)}</td>
              <td>
                ${statusBadge}
                ${toggleBtn}
              </td>
            </tr>
          `;
        }).join('');
      }

      async function toggleUserHosting(userId, pause) {
        try {
          const action = pause ? 'pause' : 'resume';
          const response = await fetch(`/monitoring/users/${encodeURIComponent(userId)}/${action}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
          });

          const result = await response.json();
          const data = unwrapResponse(result);

          if (data) {
            // Âà∑Êñ∞‰ª™Ë°®Áõò‰ª•Êõ¥Êñ∞Áî®Êà∑Áä∂ÊÄÅ
            await refreshDashboard();
            console.log(data.message);
          }
        } catch (error) {
          console.error('ÂàáÊç¢Áî®Êà∑ÊâòÁÆ°Áä∂ÊÄÅÂ§±Ë¥•', error);
        }
      }

      async function refreshHealthStatus() {
        try {
          const response = await fetch('/agent/health');
          const result = await response.json();
          const health = unwrapResponse(result);
          updateHealthCard(
            'overallHealthCard',
            'overallHealthStatus',
            'overallHealthMessage',
            health.status === 'healthy' ? 'success' : 'warning',
            health.status === 'healthy' ? 'ËøêË°åÊ≠£Â∏∏' : 'ÊúçÂä°ÈôçÁ∫ß',
            health.message || 'Agent ÊúçÂä°Áä∂ÊÄÅÊú™Áü•',
          );

          // Ê®°ÂûãÁä∂ÊÄÅÔºö‰ΩøÁî®ÂêéÁ´ØÂÆûÈôÖËøîÂõûÁöÑÂ≠óÊÆµ
          const isModelOk = health.models?.configuredAvailable || health.models?.allConfiguredModelsAvailable;
          const modelAvailableCount = health.models?.availableCount || 0;
          const modelConfiguredCount = health.models?.configuredCount || 0;
          updateHealthCard(
            'modelHealthCard',
            'modelHealthStatus',
            'modelHealthDetails',
            isModelOk ? 'success' : 'warning',
            isModelOk ? 'ÊúçÂä°ÂèØÁî®' : 'ÈúÄÂÖ≥Ê≥®',
            isModelOk
              ? `${modelAvailableCount}/${modelConfiguredCount} Ê®°ÂûãÂèØÁî®`
              : `${modelAvailableCount}/${modelConfiguredCount} Ê®°ÂûãÂèØÁî®ÔºåÈÉ®ÂàÜ‰∏çÂèØÁî®`,
          );

          // Â∑•ÂÖ∑Áä∂ÊÄÅÔºö‰ΩøÁî®ÂêéÁ´ØÂÆûÈôÖËøîÂõûÁöÑÂ≠óÊÆµ
          const isToolOk = health.tools?.allAvailable;
          const toolAvailableCount = health.tools?.availableCount || 0;
          const toolConfiguredCount = health.tools?.configuredCount || 0;
          updateHealthCard(
            'toolHealthCard',
            'toolHealthStatus',
            'toolHealthDetails',
            isToolOk ? 'success' : 'warning',
            isToolOk ? 'ÂìçÂ∫îÊ≠£Â∏∏' : 'ÂìçÂ∫îÁºìÊÖ¢',
            isToolOk
              ? `${toolAvailableCount}/${toolConfiguredCount} Â∑•ÂÖ∑ÂèØÁî®`
              : `${toolAvailableCount}/${toolConfiguredCount} Â∑•ÂÖ∑ÂèØÁî®ÔºåÈÉ®ÂàÜ‰∏çÂèØÁî®`,
          );

          // ÂìÅÁâåÈÖçÁΩÆÁä∂ÊÄÅ
          const brandConfig = health.brandConfig;
          const isBrandOk = brandConfig?.available && brandConfig?.synced;
          const brandLastUpdate = brandConfig?.lastUpdated
            ? formatTime(brandConfig.lastUpdated)
            : 'Êú™Áü•';
          updateHealthCard(
            'brandHealthCard',
            'brandHealthStatus',
            'brandHealthDetails',
            isBrandOk ? 'success' : 'warning',
            isBrandOk ? 'Êï∞ÊçÆÂêåÊ≠•' : 'ÈúÄÂêåÊ≠•',
            isBrandOk
              ? `Êõ¥Êñ∞‰∫é ${brandLastUpdate}`
              : brandConfig?.available ? 'ÂìÅÁâåÊï∞ÊçÆÂæÖÂêåÊ≠•' : 'ÂìÅÁâåÊï∞ÊçÆ‰∏çÂèØÁî®',
          );

          // Êõ¥Êñ∞È°∂ÈÉ®ÂÅ•Â∫∑Áä∂ÊÄÅÂæΩÁ´†
          const badge = document.getElementById('overallHealthBadge');
          if (badge) {
            const isHealthy = health.status === 'healthy';

            if (isHealthy && isModelOk && isToolOk && isBrandOk) {
              badge.textContent = 'ÂÖ®ÈÉ®Ê≠£Â∏∏';
              badge.className = 'health-panel-badge';
            } else if (!isHealthy) {
              badge.textContent = 'ÊúçÂä°ÂºÇÂ∏∏';
              badge.className = 'health-panel-badge error';
            } else {
              badge.textContent = 'ÈÉ®ÂàÜÂºÇÂ∏∏';
              badge.className = 'health-panel-badge warning';
            }
          }

        } catch (error) {
          console.error('Ëé∑ÂèñÂÅ•Â∫∑Áä∂ÊÄÅÂ§±Ë¥•', error);
          // Êõ¥Êñ∞ÂæΩÁ´†‰∏∫ÈîôËØØÁä∂ÊÄÅ
          const badge = document.getElementById('overallHealthBadge');
          if (badge) {
            badge.textContent = 'Ê£ÄÊü•Â§±Ë¥•';
            badge.className = 'health-panel-badge error';
          }
        }
      }

      function updateHealthCard(cardId, statusId, descId, state, statusText, desc) {
        const card = document.getElementById(cardId);
        const status = document.getElementById(statusId);
        const descEl = document.getElementById(descId);
        if (!card || !status || !descEl) return;
        card.dataset.state = state;
        status.textContent = statusText;
        descEl.textContent = desc;
      }

      async function clearData() {
        try {
          await fetch('/monitoring/clear', { method: 'POST' });
          await refreshDashboard();
        } catch (error) {
          console.error('Ê∏ÖÁ©∫Êï∞ÊçÆÂ§±Ë¥•', error);
        }
      }

      function formatTime(timestamp) {
        if (!timestamp) return '-';
        const date = new Date(timestamp);
        return date.toLocaleString('zh-CN', { hour12: false });
      }

      function formatMinuteLabel(value) {
        if (!value) return '-';
        const date = new Date(value);
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        return `${hours}:${minutes}`;
      }

      function formatDayLabel(value) {
        if (!value) return '-';
        const date = new Date(value);
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${month}-${day}`;
      }

      function formatDuration(value, fractionDigits = 2) {
        if (value === undefined || value === null) return '-';
        const seconds = value / 1000;
        return `${seconds.toFixed(fractionDigits)} Áßí`;
      }
    </script>
    <script>
      // Christmas Decoration Script
      document.addEventListener('DOMContentLoaded', () => {
        // 1. Decorate Cards with Stickers
        const cards = document.querySelectorAll('.metric-card, .chart-card, .insight-card');
        // Expanded festive emoji list
        const decorations = ['üéÄ', 'üß¶', '‚õÑ', 'üéÅ', 'üç¨', 'üîî', 'ü¶å', 'üéÖ', 'üéÑ', 'üç≠', 'üéà', 'üéâ', 'üéä', 'ü•®', 'üç©', '‚ùÑÔ∏è', '‚òÉÔ∏è'];
        
        cards.forEach((card, index) => {
          // Randomly decide to add a sticker (80% chance)
          if (Math.random() > 0.2) {
            const sticker = document.createElement('div');
            sticker.className = 'christmas-sticker sticker-tr';
            // Pick a random decoration
            sticker.textContent = decorations[Math.floor(Math.random() * decorations.length)];
            // Add some random delay to animations if we add them later
            sticker.style.animationDelay = `${Math.random() * 2}s`;
            card.appendChild(sticker);
          }
          
          // Occasionally add a second sticker to the left (30% chance)
          if (Math.random() > 0.7) {
             const sticker2 = document.createElement('div');
             sticker2.className = 'christmas-sticker sticker-tl';
             sticker2.textContent = decorations[Math.floor(Math.random() * decorations.length)];
             card.appendChild(sticker2);
          }
        });

        // 2. Add Hanging Garland
        const garland = document.createElement('div');
        garland.className = 'christmas-garland';
        
        // Add the string visual
        const string = document.createElement('div');
        string.className = 'garland-string';
        garland.appendChild(string);

        // Add hanging items
        const hangingItems = ['üí°', 'üéà', 'üéÄ', 'üç¨', 'ü¶å', 'üîî', 'üç≠', '‚õÑ', 'üéÅ', '‚ùÑÔ∏è', 'üéÑ', 'ü•®'];
        for(let i=0; i<12; i++) {
          const item = document.createElement('div');
          item.className = 'garland-item';
          item.textContent = hangingItems[Math.floor(Math.random() * hangingItems.length)];
          item.style.animationDelay = `${Math.random() * 2}s`;
          item.style.fontSize = `${24 + Math.random() * 16}px`; // Random sizes
          garland.appendChild(item);
        }
        document.body.appendChild(garland);
      });
    </script>
  </body>
</html>
