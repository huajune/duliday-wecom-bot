<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bot ç›‘æ§ä»ªè¡¨ç›˜ - DuLiDay</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
      :root {
        --bg-dark: #050505;
        --bg-card: #111319;
        --bg-card-light: #161923;
        --border: rgba(255, 255, 255, 0.08);
        --text-primary: #f9fafb;
        --text-secondary: #9ca3af;
        --text-muted: #6b7280;
        --primary: #3b82f6;
        --primary-dark: #2563eb;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --info: #38bdf8;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: 'PingFang SC', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI',
          sans-serif;
        background: var(--bg-dark);
        color: var(--text-primary);
        padding: 40px 24px 80px;
      }

      .background-gradients {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 0;
      }

      .background-gradients span {
        position: absolute;
        width: 400px;
        height: 400px;
        filter: blur(150px);
        opacity: 0.3;
      }

      .bg-blue {
        background: #1e3a8a;
        top: -120px;
        left: -100px;
      }

      .bg-purple {
        background: #6d28d9;
        right: -120px;
        bottom: 40px;
      }

      .container {
        position: relative;
        z-index: 1;
        max-width: 1440px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .header {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 32px;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .header-top {
        display: flex;
        justify-content: space-between;
        gap: 24px;
        flex-wrap: wrap;
      }

      .header h1 {
        margin: 4px 0 8px;
        font-size: 28px;
      }

      .eyebrow {
        color: var(--text-muted);
        font-size: 13px;
        letter-spacing: 0.2em;
        text-transform: uppercase;
      }

      .header-actions {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .filters {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .filters {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .filters button {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text-secondary);
        border-radius: 999px;
        padding: 6px 14px;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .filters button:hover {
        border-color: var(--primary);
      }

      .filters button.active {
        background: rgba(59, 130, 246, 0.15);
        border-color: var(--primary);
        color: var(--text-primary);
      }

      .header-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
      }

      .btn {
        border-radius: 10px;
        padding: 10px 16px;
        border: 1px solid transparent;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .btn-primary {
        background: var(--primary);
        color: #fff;
      }

      .btn-ghost {
        background: transparent;
        border-color: var(--border);
        color: var(--text-secondary);
      }

      .auto-refresh {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
        color: var(--text-secondary);
      }

      .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--success);
        box-shadow: 0 0 12px rgba(16, 185, 129, 0.7);
      }

      /* å¼€å…³æ ·å¼ */
      .toggle-switch {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 13px;
        color: var(--text-secondary);
      }

      .toggle-switch input[type='checkbox'] {
        appearance: none;
        width: 44px;
        height: 24px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid var(--border);
        border-radius: 12px;
        position: relative;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .toggle-switch input[type='checkbox']::before {
        content: '';
        position: absolute;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: var(--text-secondary);
        top: 2px;
        left: 2px;
        transition: all 0.3s ease;
      }

      .toggle-switch input[type='checkbox']:checked {
        background: var(--success);
        border-color: var(--success);
      }

      .toggle-switch input[type='checkbox']:checked::before {
        background: white;
        left: 22px;
      }

      .toggle-switch input[type='checkbox']:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .toggle-switch .status-text {
        min-width: 40px;
        font-weight: 500;
      }

      .toggle-switch .status-text.enabled {
        color: var(--success);
      }

      .toggle-switch .status-text.disabled {
        color: var(--danger);
      }

      .last-update {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
        font-size: 13px;
      }

      .section {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 24px;
      }

      .page-footnote {
        margin-top: 12px;
        text-align: right;
        color: var(--text-muted);
        font-size: 12px;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 12px;
      }

      .btn-ghost.danger-link {
        border-color: transparent;
        color: var(--text-muted);
        padding: 6px 10px;
        font-size: 12px;
      }

      .btn-ghost.danger-link:hover {
        color: var(--danger);
        border-color: rgba(239, 68, 68, 0.3);
      }

      .health-grid {
        display: grid;
        gap: 16px;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      }

      .health-card {
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 20px;
        display: flex;
        gap: 16px;
        align-items: center;
        background: var(--bg-card-light);
      }

      .health-card[data-state='error'] {
        border-color: rgba(239, 68, 68, 0.4);
        background: rgba(239, 68, 68, 0.08);
      }

      .health-card[data-state='warning'] {
        border-color: rgba(245, 158, 11, 0.4);
        background: rgba(245, 158, 11, 0.08);
      }

      .health-icon {
        font-size: 30px;
      }

      .health-title {
        font-size: 13px;
        color: var(--text-muted);
        letter-spacing: 0.08em;
      }

      .health-status {
        font-size: 18px;
        font-weight: 600;
      }

      .health-desc {
        color: var(--text-secondary);
        font-size: 13px;
      }

      .metric-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
      }

      .metric-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        position: relative;
        overflow: hidden;
      }

      .metric-card::after {
        content: '';
        position: absolute;
        inset: 0;
        opacity: 0.2;
        pointer-events: none;
      }

      .metric-card.primary::after {
        background: radial-gradient(circle at top right, rgba(59, 130, 246, 0.4), transparent);
      }

      .metric-card.success::after {
        background: radial-gradient(circle at top right, rgba(16, 185, 129, 0.4), transparent);
      }

      .metric-label {
        font-size: 13px;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .metric-value {
        font-size: 28px;
        font-weight: 600;
      }

      .metric-subtitle {
        font-size: 13px;
        color: var(--text-secondary);
      }

      .metric-delta {
        font-size: 13px;
        font-weight: 600;
      }

      .metric-delta.positive {
        color: var(--success);
      }

      .metric-delta.negative {
        color: var(--danger);
      }

      .charts-row {
        display: grid;
        gap: 20px;
        grid-template-columns: 2fr 1fr;
      }

      .chart-card {
        border-radius: 20px;
        border: 1px solid var(--border);
        padding: 24px;
        background: var(--bg-card);
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
      }

      .chart-header h3 {
        margin: 0;
        font-size: 18px;
      }

      .chart-header p {
        margin: 2px 0 0;
        color: var(--text-secondary);
        font-size: 13px;
      }

      .chart-kpi {
        text-align: right;
        font-size: 12px;
        color: var(--text-muted);
      }

      .chart-kpi strong {
        display: block;
        font-size: 18px;
        color: var(--text-primary);
      }

      canvas {
        width: 100% !important;
        height: 320px !important;
      }

      .insight-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 16px;
      }

      .insight-card {
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 20px;
        background: var(--bg-card);
      }

      .insight-title {
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-muted);
        margin-bottom: 12px;
      }

      .insight-metrics {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
      }

      .insight-metrics div span {
        font-size: 12px;
        color: var(--text-secondary);
      }

      .insight-metrics div strong {
        display: block;
        font-size: 20px;
      }

      .percentiles {
        display: grid;
        grid-template-columns: repeat(2, minmax(100px, 1fr));
        gap: 12px;
      }

      .percentiles span {
        font-size: 12px;
        color: var(--text-secondary);
      }

      .percentiles strong {
        display: block;
        font-size: 18px;
      }

      .alert-type-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .alert-type-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 0;
        border-bottom: 1px solid var(--border);
      }

      .alert-type-item:last-child {
        border-bottom: none;
      }

      .alert-type-label {
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 100px;
        font-size: 13px;
      }

      .alert-type-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 20px;
        height: 20px;
        border-radius: 6px;
        font-size: 11px;
      }

      .alert-type-badge.agent {
        background: rgba(239, 68, 68, 0.2);
        color: var(--danger);
      }

      .alert-type-badge.message {
        background: rgba(245, 158, 11, 0.2);
        color: var(--warning);
      }

      .alert-type-badge.delivery {
        background: rgba(59, 130, 246, 0.2);
        color: var(--primary);
      }

      .alert-type-badge.merge {
        background: rgba(168, 85, 247, 0.2);
        color: #a855f7;
      }

      .alert-type-badge.unknown {
        background: rgba(156, 163, 175, 0.2);
        color: var(--text-muted);
      }

      .alert-type-bar {
        flex: 1;
        height: 6px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 3px;
        overflow: hidden;
        position: relative;
      }

      .alert-type-bar-fill {
        height: 100%;
        border-radius: 3px;
        transition: width 0.3s ease;
      }

      .alert-type-bar-fill.agent {
        background: var(--danger);
      }

      .alert-type-bar-fill.message {
        background: var(--warning);
      }

      .alert-type-bar-fill.delivery {
        background: var(--primary);
      }

      .alert-type-bar-fill.merge {
        background: #a855f7;
      }

      .alert-type-bar-fill.unknown {
        background: var(--text-muted);
      }

      .alert-type-stats {
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 80px;
        justify-content: flex-end;
        font-size: 12px;
      }

      .alert-type-count {
        font-weight: 600;
        color: var(--text-primary);
      }

      .alert-type-percentage {
        color: var(--text-secondary);
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .section-header h3 {
        margin: 0;
        font-size: 16px;
      }

      .table-wrapper {
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead th {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--text-muted);
        padding: 10px 12px;
        border-bottom: 1px solid var(--border);
        text-align: left;
      }

      tbody td {
        padding: 12px;
        border-bottom: 1px solid var(--border);
        font-size: 13px;
        color: var(--text-secondary);
      }

      tbody tr:hover {
        background: rgba(255, 255, 255, 0.02);
      }

      .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border-radius: 999px;
        padding: 2px 10px;
        font-size: 12px;
        border: 1px solid transparent;
      }

      .status-badge.success {
        border-color: rgba(16, 185, 129, 0.4);
        color: var(--success);
      }

      .status-badge.warning {
        border-color: rgba(245, 158, 11, 0.4);
        color: var(--warning);
      }

      .status-badge.danger {
        border-color: rgba(239, 68, 68, 0.4);
        color: var(--danger);
      }

      .loading {
        padding: 24px;
        text-align: center;
        color: var(--text-secondary);
      }

      @media (max-width: 960px) {
        .charts-row {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="background-gradients">
      <span class="bg-blue"></span>
      <span class="bg-purple"></span>
    </div>
    <div class="container">
      <div class="header">
        <div class="header-top">
          <div>
            <div class="eyebrow">ç‹¬ç«‹æ—¥ Bot</div>
            <h1>è¿è¥ç›‘æ§ä»ªè¡¨ç›˜</h1>
            <p>å®æ—¶æ´å¯Ÿä»£ç†å¥åº·ã€æ¶ˆæ¯ååã€å‘Šè­¦ä¸åŠŸèƒ½ä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶å®šä½å¼‚å¸¸ã€‚</p>
          </div>
          <div class="last-update">
            <span class="status-indicator"></span>
            <span>æœ€åæ›´æ–°: <span id="lastUpdate">-</span></span>
          </div>
        </div>
        <div class="header-actions">
          <div class="filters">
            <button class="active" data-range="today">æœ¬æ—¥</button>
            <button data-range="week">æœ¬å‘¨</button>
            <button data-range="month">æœ¬æœˆ</button>
          </div>
          <div class="header-controls">
            <label class="toggle-switch">
              <span>ğŸ¤– æ™ºèƒ½å›å¤</span>
              <input type="checkbox" id="aiReplyToggle" />
              <span class="status-text" id="aiReplyStatus">-</span>
            </label>
            <label class="auto-refresh">
              <input type="checkbox" id="autoRefresh" checked />
              è‡ªåŠ¨åˆ·æ–° (5ç§’)
            </label>
          </div>
        </div>
      </div>

      <section class="health-grid">
        <article class="health-card" id="overallHealthCard" data-state="loading">
          <div class="health-icon">ğŸ›°ï¸</div>
          <div>
            <div class="health-title">æ•´ä½“çŠ¶æ€</div>
            <div class="health-status" id="overallHealthStatus">-</div>
            <div class="health-desc" id="overallHealthMessage">æ£€æŸ¥ä¸­...</div>
          </div>
        </article>
        <article class="health-card" id="modelHealthCard" data-state="loading">
          <div class="health-icon">ğŸ¤–</div>
          <div>
            <div class="health-title">AI æ¨¡å‹</div>
            <div class="health-status" id="modelHealthStatus">-</div>
            <div class="health-desc" id="modelHealthDetails">æ£€æŸ¥ä¸­...</div>
          </div>
        </article>
        <article class="health-card" id="toolHealthCard" data-state="loading">
          <div class="health-icon">ğŸ§°</div>
          <div>
            <div class="health-title">å·¥å…·æœåŠ¡</div>
            <div class="health-status" id="toolHealthStatus">-</div>
            <div class="health-desc" id="toolHealthDetails">æ£€æŸ¥ä¸­...</div>
          </div>
        </article>
      </section>

      <section class="metric-grid">
        <article class="metric-card primary">
          <div class="metric-label">
            æ¶ˆæ¯æ€»é‡
            <span class="time-range-badge" id="timeRangeBadge" style="font-size: 11px; opacity: 0.7;"></span>
          </div>
          <div class="metric-value" id="totalMessages">-</div>
          <div class="metric-subtitle">æˆåŠŸ + å¤±è´¥</div>
          <div class="metric-delta" id="totalMessagesDelta">-</div>
        </article>
        <article class="metric-card success">
          <div class="metric-label">æˆåŠŸç‡</div>
          <div class="metric-value" id="successRate">-</div>
          <div class="metric-subtitle" id="successCount">-</div>
          <div class="metric-delta" id="successRateDelta">-</div>
        </article>
        <article class="metric-card">
          <div class="metric-label">å¹³å‡å“åº”</div>
          <div class="metric-value" id="avgDuration">-</div>
          <div class="metric-subtitle">ç§’</div>
          <div class="metric-delta" id="avgDurationDelta">-</div>
        </article>
        <article class="metric-card">
          <div class="metric-label">æ´»è·ƒç”¨æˆ·</div>
          <div class="metric-value" id="activeUsers">-</div>
          <div class="metric-subtitle" id="activeChats">-</div>
          <div class="metric-delta" id="activeUsersDelta">-</div>
        </article>
        <article class="metric-card" style="border: 1px solid rgba(245, 158, 11, 0.3);">
          <div class="metric-label">é™çº§æ¬¡æ•°</div>
          <div class="metric-value" id="fallbackCount">-</div>
          <div class="metric-subtitle" id="fallbackRate">-</div>
          <div class="metric-delta" id="fallbackDelta">-</div>
        </article>
      </section>

      <!-- ä¸šåŠ¡æŒ‡æ ‡åŒºåŸŸ -->
      <section class="business-metrics">
        <div class="section-header" style="margin-bottom: 16px;">
          <h3 style="font-size: 18px; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
            <span>ğŸ“Š</span>
            <span>ä¸šåŠ¡æŒ‡æ ‡</span>
            <span class="time-range-badge" id="businessTimeRangeBadge" style="font-size: 11px; opacity: 0.7;"></span>
          </h3>
          <p style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">æ ¸å¿ƒä¸šåŠ¡è½¬åŒ–ä¸ç”¨æˆ·è¡Œä¸ºæ´å¯Ÿ</p>
        </div>
        <div class="metric-grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));">
          <!-- æ€»å’¨è¯¢äººæ•° -->
          <article class="metric-card" style="border: 1px solid rgba(99, 102, 241, 0.3);">
            <div class="metric-label">æ€»å’¨è¯¢äººæ•°</div>
            <div class="metric-value" id="businessConsultationsTotal">-</div>
            <div class="metric-subtitle">
              æ–°å¢ <span id="businessConsultationsNew">-</span> äºº
            </div>
            <div class="metric-delta" id="businessConsultationsDelta">-</div>
          </article>

          <!-- é¢„çº¦é¢è¯•äººæ•° -->
          <article class="metric-card" style="border: 1px solid rgba(168, 85, 247, 0.3);">
            <div class="metric-label">é¢„çº¦é¢è¯•æ¬¡æ•°</div>
            <div class="metric-value" id="businessBookingAttempts">-</div>
            <div class="metric-subtitle">
              æˆåŠŸ <span id="businessBookingSuccessful" style="color: var(--success);">-</span> /
              å¤±è´¥ <span id="businessBookingFailed" style="color: var(--danger);">-</span>
            </div>
            <div class="metric-delta" id="businessBookingAttemptsDelta">-</div>
          </article>

          <!-- é¢„çº¦æˆåŠŸç‡ -->
          <article class="metric-card success" style="border: 1px solid rgba(16, 185, 129, 0.3);">
            <div class="metric-label">é¢„çº¦æˆåŠŸç‡</div>
            <div class="metric-value" id="businessBookingSuccessRate">-</div>
            <div class="metric-subtitle">
              å’¨è¯¢è½¬åŒ–ç‡ <span id="businessConversionRate">-</span>
            </div>
            <div class="metric-delta" id="businessBookingSuccessRateDelta">-</div>
          </article>
        </div>
      </section>

      <!-- ä¸šåŠ¡æŒ‡æ ‡è¶‹åŠ¿ -->
      <section class="charts-row">
        <div class="chart-card">
          <div class="chart-header">
            <div>
              <h3>å’¨è¯¢äººæ•°è¶‹åŠ¿</h3>
              <p>æ´»è·ƒç”¨æˆ·æ•°é‡å˜åŒ–</p>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="consultationsTrendChart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-header">
            <div>
              <h3>é¢„çº¦è½¬åŒ–è¶‹åŠ¿</h3>
              <p>é¢„çº¦æ¬¡æ•°ä¸æˆåŠŸç‡</p>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="bookingTrendChart"></canvas>
          </div>
        </div>
      </section>

      <section class="charts-row">
        <div class="chart-card">
          <div class="chart-header">
            <div>
              <h3>å“åº”è€—æ—¶ï¼ˆç§’ï¼‰</h3>
              <p>æœ€è¿‘ <span id="chartRangeLabel">60</span> åˆ†é’Ÿ</p>
            </div>
            <div class="chart-kpi">
              <span>å½“å‰å¹³å‡è€—æ—¶</span>
              <strong id="responseChartAvg">-</strong>
            </div>
          </div>
          <canvas id="responseTrendChart"></canvas>
        </div>
        <div class="chart-card">
          <div class="chart-header">
            <div>
              <h3>å‘Šè­¦é‡è¶‹åŠ¿</h3>
              <p>æœ€è¿‘ 60 åˆ†é’Ÿ</p>
            </div>
            <div class="chart-kpi">
              <span>è¿‘5åˆ†é’Ÿå‘Šè­¦</span>
              <strong id="alertTrendRecent">-</strong>
            </div>
          </div>
          <canvas id="alertTrendChart"></canvas>
        </div>
      </section>

      <section class="insight-grid">
        <article class="insight-card">
          <div class="insight-title">æ’é˜Ÿä¸å“åº”</div>
          <div class="insight-metrics">
            <div>
              <span>å®æ—¶å¤„ç†ä¸­</span>
              <strong id="queueCurrent">-</strong>
            </div>
            <div>
              <span>å³°å€¼é˜Ÿåˆ—</span>
              <strong id="queuePeak">-</strong>
            </div>
            <div>
              <span>å¹³å‡ç­‰å¾…</span>
              <strong id="queueAvgWait">-</strong>
            </div>
          </div>
        </article>
        <article class="insight-card">
          <div class="insight-title">å»¶è¿Ÿåˆ†å¸ƒ</div>
          <div class="percentiles">
            <div>
              <span>P50</span>
              <strong id="p50Duration">-</strong>
            </div>
            <div>
              <span>P95</span>
              <strong id="p95Duration">-</strong>
            </div>
            <div>
              <span>P99</span>
              <strong id="p99Duration">-</strong>
            </div>
          </div>
        </article>
        <article class="insight-card">
          <div class="insight-title">å‘Šè­¦æ¦‚è§ˆ</div>
          <div class="insight-metrics">
            <div>
              <span>ç´¯è®¡</span>
              <strong id="alertTotal">-</strong>
            </div>
            <div>
              <span>è¿‘24å°æ—¶</span>
              <strong id="alertRecent">-</strong>
            </div>
          </div>
        </article>
        <article class="insight-card">
          <div class="insight-title">å‘Šè­¦ç±»å‹åˆ†å¸ƒ</div>
          <div id="alertTypeList" class="alert-type-list">
            <div class="loading" style="padding: 12px 0; font-size: 13px;">æš‚æ— æ•°æ®</div>
          </div>
        </article>
      </section>

      <section class="section">
        <div class="section-header">
          <h3>æœ€æ…¢è®°å½• (Top 10)</h3>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>æ—¶é—´</th>
                <th>ç”¨æˆ·</th>
                <th>æ¶ˆæ¯é¢„è§ˆ</th>
                <th>æ€»è€—æ—¶</th>
                <th>AI è€—æ—¶</th>
                <th>å›å¤æ¡æ•°</th>
                <th>çŠ¶æ€</th>
              </tr>
            </thead>
            <tbody id="slowestRecords">
              <tr>
                <td colspan="7" class="loading">åŠ è½½ä¸­</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="section">
        <div class="section-header">
          <h3>å®æ—¶æ¶ˆæ¯ï¼ˆæœ€æ–° 50 æ¡ï¼‰</h3>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>æ—¶é—´</th>
                <th>ç”¨æˆ·</th>
                <th>ç”¨æˆ·æ¶ˆæ¯</th>
                <th>å›å¤é¢„è§ˆ</th>
                <th>æ€»è€—æ—¶</th>
                <th>çŠ¶æ€</th>
              </tr>
            </thead>
            <tbody id="recentMessages">
              <tr>
                <td colspan="6" class="loading">åŠ è½½ä¸­</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <div class="page-footnote">
        <button class="btn btn-ghost danger-link" type="button" onclick="clearData()">æ¸…ç©ºç›‘æ§æ•°æ®</button>
        <span>ä»…åœ¨éœ€è¦é‡ç½®ç»Ÿè®¡æ—¶ä½¿ç”¨</span>
      </div>
    </div>

    <script>
      let autoRefreshInterval = null;
      let responseTrendChart = null;
      let alertTrendChart = null;
      let consultationsTrendChart = null;
      let bookingTrendChart = null;
      let cachedDashboard = null;
      let cachedMetrics = null;
      let currentTimeRange = 'today';
      const unwrapResponse = (payload) => {
        let current = payload;
        while (current && typeof current === 'object' && 'data' in current) {
          current = current.data;
        }
        return current;
      };

      document.addEventListener('DOMContentLoaded', () => {
        initCharts();
        setupAutoRefreshToggle();
        setupAiReplyToggle();
        setupTimeRangeFilters();
        refreshAll();
        loadAiReplyStatus();
      });

      async function refreshAll() {
        await Promise.all([refreshHealthStatus(), refreshDashboard()]);
      }

      function setupAutoRefreshToggle() {
        const checkbox = document.getElementById('autoRefresh');
        checkbox.addEventListener('change', toggleAutoRefresh);
        toggleAutoRefresh();
      }

      function toggleAutoRefresh() {
        const checkbox = document.getElementById('autoRefresh');
        if (checkbox.checked) {
          if (autoRefreshInterval) clearInterval(autoRefreshInterval);
          autoRefreshInterval = setInterval(refreshDashboard, 5000);
        } else if (autoRefreshInterval) {
          clearInterval(autoRefreshInterval);
          autoRefreshInterval = null;
        }
      }

      function setupAiReplyToggle() {
        const checkbox = document.getElementById('aiReplyToggle');
        checkbox.addEventListener('change', handleAiReplyToggle);
      }

      async function loadAiReplyStatus() {
        try {
          const response = await fetch('/monitoring/ai-reply-status');
          const result = await response.json();
          const payload = unwrapResponse(result);
          updateAiReplyUI(payload?.enabled ?? false);
        } catch (error) {
          console.error('è·å– AI å›å¤çŠ¶æ€å¤±è´¥', error);
        }
      }

      async function handleAiReplyToggle() {
        const checkbox = document.getElementById('aiReplyToggle');
        const enabled = checkbox.checked;

        try {
          checkbox.disabled = true;
          const response = await fetch('/monitoring/toggle-ai-reply', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ enabled }),
          });

          const result = await response.json();
          const responseData = unwrapResponse(result);
          updateAiReplyUI(responseData?.enabled ?? enabled);

          // æ˜¾ç¤ºé€šçŸ¥
          console.log(responseData?.message || 'çŠ¶æ€å·²æ›´æ–°');
        } catch (error) {
          console.error('åˆ‡æ¢ AI å›å¤çŠ¶æ€å¤±è´¥', error);
          // æ¢å¤åŸæ¥çš„çŠ¶æ€
          checkbox.checked = !enabled;
        } finally {
          checkbox.disabled = false;
        }
      }

      function updateAiReplyUI(enabled) {
        const checkbox = document.getElementById('aiReplyToggle');
        const statusText = document.getElementById('aiReplyStatus');

        checkbox.checked = enabled;
        statusText.textContent = enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
        statusText.className = enabled ? 'status-text enabled' : 'status-text disabled';
      }

      function setupTimeRangeFilters() {
        const filterButtons = document.querySelectorAll('.filters button[data-range]');
        filterButtons.forEach(button => {
          button.addEventListener('click', () => {
            filterButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            currentTimeRange = button.dataset.range;
            refreshDashboard();
          });
        });
      }

      async function refreshDashboard() {
        try {
          const [dashboardRes, metricsRes] = await Promise.all([
            fetch(`/monitoring/dashboard?range=${currentTimeRange}`),
            fetch('/monitoring/metrics'),
          ]);
          const dashboardPayload = await dashboardRes.json();
          const metricsPayload = await metricsRes.json();
          const dashboard = unwrapResponse(dashboardPayload);
          const metrics = unwrapResponse(metricsPayload);
          cachedDashboard = dashboard;
          cachedMetrics = metrics;
          renderDashboard(dashboard, metrics);
          document.getElementById('lastUpdate').textContent = formatTime(Date.now());
        } catch (error) {
          console.error('åŠ è½½ç›‘æ§æ•°æ®å¤±è´¥', error);
        }
      }

      function renderDashboard(dashboard, metrics) {
        updateTimeRangeBadge(dashboard.timeRange);
        updateOverview(dashboard);
        updateFallbackStats(dashboard.fallback, dashboard.fallbackDelta);
        updateBusinessMetrics(dashboard.business, dashboard.businessDelta);
        updateQueueInfo(dashboard);
        updatePercentiles(metrics.percentiles);
        updateSlowestTable(metrics.slowestRecords);
        updateRecentMessages(dashboard.recentMessages);
        updateCharts(dashboard);
      }

      function updateOverview(data) {
        const { overview, overviewDelta } = data;
        setMetric('totalMessages', overview.totalMessages);
        setMetric('successRate', `${overview.successRate.toFixed(1)}%`);
        setMetric('avgDuration', formatDuration(overview.avgDuration));
        setMetric('activeUsers', overview.activeUsers);
        document.getElementById('successCount').textContent = `æˆåŠŸ ${overview.successCount} æ¡`;
        document.getElementById('activeChats').textContent = `${overview.activeChats} ä¸ªä¼šè¯`;
        setDelta('totalMessagesDelta', overviewDelta.totalMessages);
        setDelta('successRateDelta', overviewDelta.successRate);
        setDelta('avgDurationDelta', overviewDelta.avgDuration);
        setDelta('activeUsersDelta', overviewDelta.activeUsers);
      }

      function setMetric(id, value) {
        const el = document.getElementById(id);
        if (el) {
          el.textContent = value ?? '-';
        }
      }

      function setDelta(id, delta) {
        const el = document.getElementById(id);
        if (!el || delta === undefined || delta === null) {
          return;
        }
        const val = parseFloat(delta.toFixed(1));
        el.textContent = `${val >= 0 ? '+' : ''}${val}%`;
        el.classList.toggle('positive', val >= 0);
        el.classList.toggle('negative', val < 0);
      }

      function updateQueueInfo(data) {
        const queue = data.queue || {};
        document.getElementById('queueCurrent').textContent = queue.currentProcessing ?? '-';
        document.getElementById('queuePeak').textContent = queue.peakProcessing ?? '-';
        document.getElementById('queueAvgWait').textContent = queue.avgQueueDuration
          ? formatDuration(queue.avgQueueDuration)
          : '-';
        const alerts = data.alertsSummary || { total: 0, last24Hours: 0, byType: [] };
        document.getElementById('alertTotal').textContent = alerts.total;
        document.getElementById('alertRecent').textContent = alerts.last24Hours;
        updateAlertTypeList(alerts.byType || []);
      }

      function updateAlertTypeList(alertTypes) {
        const container = document.getElementById('alertTypeList');
        if (!alertTypes || alertTypes.length === 0) {
          container.innerHTML = '<div class="loading" style="padding: 12px 0; font-size: 13px;">æš‚æ— æ•°æ®</div>';
          return;
        }

        const typeLabels = {
          agent: 'AI ä»£ç†',
          message: 'æ¶ˆæ¯å¤„ç†',
          delivery: 'æ¶ˆæ¯å‘é€',
          merge: 'æ¶ˆæ¯åˆå¹¶',
          unknown: 'æœªçŸ¥ç±»å‹',
        };

        const typeIcons = {
          agent: 'ğŸ¤–',
          message: 'ğŸ’¬',
          delivery: 'ğŸ“¤',
          merge: 'ğŸ”€',
          unknown: 'â“',
        };

        container.innerHTML = alertTypes
          .map(
            (item) => `
          <div class="alert-type-item">
            <div class="alert-type-label">
              <span class="alert-type-badge ${item.type}">${typeIcons[item.type] || 'â“'}</span>
              <span>${typeLabels[item.type] || item.type}</span>
            </div>
            <div class="alert-type-bar">
              <div class="alert-type-bar-fill ${item.type}" style="width: ${item.percentage}%"></div>
            </div>
            <div class="alert-type-stats">
              <span class="alert-type-count">${item.count}</span>
              <span class="alert-type-percentage">${item.percentage}%</span>
            </div>
          </div>
        `,
          )
          .join('');
      }

      function updateTimeRangeBadge(timeRange) {
        const badge = document.getElementById('timeRangeBadge');
        const businessBadge = document.getElementById('businessTimeRangeBadge');
        const labels = {
          'today': 'ï¼ˆæœ¬æ—¥ï¼‰',
          'week': 'ï¼ˆæœ¬å‘¨ï¼‰',
          'month': 'ï¼ˆæœ¬æœˆï¼‰'
        };
        const label = labels[timeRange] || '';
        badge.textContent = label;
        if (businessBadge) {
          businessBadge.textContent = label;
        }
      }

      function updateFallbackStats(fallback, fallbackDelta) {
        if (!fallback) return;
        document.getElementById('fallbackCount').textContent = fallback.totalCount;
        document.getElementById('fallbackRate').textContent =
          `æˆåŠŸç‡ ${fallback.successRate.toFixed(1)}% (${fallback.successCount}/${fallback.totalCount})`;
        setDelta('fallbackDelta', fallbackDelta.totalCount);
      }

      function updateBusinessMetrics(business, businessDelta) {
        if (!business) return;

        // æ€»å’¨è¯¢äººæ•°
        document.getElementById('businessConsultationsTotal').textContent = business.consultations.total;
        document.getElementById('businessConsultationsNew').textContent = business.consultations.new;
        setDelta('businessConsultationsDelta', businessDelta.consultations);

        // é¢„çº¦é¢è¯•æ¬¡æ•°
        document.getElementById('businessBookingAttempts').textContent = business.bookings.attempts;
        document.getElementById('businessBookingSuccessful').textContent = business.bookings.successful;
        document.getElementById('businessBookingFailed').textContent = business.bookings.failed;
        setDelta('businessBookingAttemptsDelta', businessDelta.bookingAttempts);

        // é¢„çº¦æˆåŠŸç‡
        document.getElementById('businessBookingSuccessRate').textContent =
          business.bookings.successRate > 0 ? `${business.bookings.successRate.toFixed(1)}%` : '0%';
        document.getElementById('businessConversionRate').textContent =
          business.conversion.consultationToBooking > 0
            ? `${business.conversion.consultationToBooking.toFixed(1)}%`
            : '0%';
        setDelta('businessBookingSuccessRateDelta', businessDelta.bookingSuccessRate);
      }

      function updatePercentiles(percentiles) {
        if (!percentiles) return;
        document.getElementById('p50Duration').textContent = formatDuration(percentiles.p50);
        document.getElementById('p95Duration').textContent = formatDuration(percentiles.p95);
        document.getElementById('p99Duration').textContent = formatDuration(percentiles.p99);
      }

      function updateSlowestTable(records) {
        const tbody = document.getElementById('slowestRecords');
        tbody.innerHTML = '';
        if (!records || records.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7" class="loading">æš‚æ— æ•°æ®</td></tr>';
          return;
        }
        records.forEach((record) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${formatTime(record.receivedAt)}</td>
            <td>${record.userName || record.chatId}</td>
            <td>${record.messagePreview || '-'}</td>
            <td>${formatDuration(record.totalDuration)}</td>
            <td>${formatDuration(record.aiDuration)}</td>
            <td>${record.replySegments ?? '-'}</td>
            <td><span class="status-badge ${record.status === 'success' ? 'success' : 'danger'}">${record.status}</span></td>
          `;
          tbody.appendChild(row);
        });
      }

      function updateRecentMessages(records) {
        const tbody = document.getElementById('recentMessages');
        tbody.innerHTML = '';
        if (!records || records.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" class="loading">æš‚æ— æ•°æ®</td></tr>';
          return;
        }
        records.forEach((record) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${formatTime(record.receivedAt)}</td>
            <td>${record.userName || record.chatId || '-'}</td>
            <td>${record.messagePreview || '-'}</td>
            <td>${record.replyPreview || '-'}</td>
            <td>${formatDuration(record.totalDuration)}</td>
            <td><span class="status-badge ${
              record.status === 'success'
                ? 'success'
                : record.status === 'failure'
                ? 'danger'
                : 'warning'
            }">${record.status}</span></td>
          `;
          tbody.appendChild(row);
        });
      }

      function initCharts() {
        const responseCtx = document.getElementById('responseTrendChart').getContext('2d');
        responseTrendChart = new Chart(responseCtx, {
          type: 'line',
          data: {
            labels: [],
            datasets: [
              {
                label: 'å¹³å‡è€—æ—¶ (ç§’)',
                data: [],
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.15)',
                fill: true,
                tension: 0.35,
                borderWidth: 2,
                pointRadius: 0,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
            },
            scales: {
              x: {
                grid: { display: false },
                ticks: { color: '#94a3b8' },
              },
              y: {
                beginAtZero: true,
                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                ticks: {
                  color: '#94a3b8',
                  callback: (value) => `${value.toFixed(2)} ç§’`,
                },
              },
            },
          },
        });

        const alertCtx = document.getElementById('alertTrendChart').getContext('2d');
        alertTrendChart = new Chart(alertCtx, {
          type: 'bar',
          data: {
            labels: [],
            datasets: [
              {
                label: 'å‘Šè­¦æ¬¡æ•°',
                data: [],
                backgroundColor: 'rgba(239, 68, 68, 0.6)',
                borderRadius: 8,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
            },
            scales: {
              x: {
                grid: { display: false },
                ticks: { color: '#94a3b8' },
              },
              y: {
                beginAtZero: true,
                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                ticks: {
                  color: '#94a3b8',
                  stepSize: 1,
                  precision: 0,
                },
              },
            },
          },
        });

        // å’¨è¯¢äººæ•°è¶‹åŠ¿å›¾è¡¨
        const consultationsCtx = document.getElementById('consultationsTrendChart').getContext('2d');
        consultationsTrendChart = new Chart(consultationsCtx, {
          type: 'line',
          data: {
            labels: [],
            datasets: [
              {
                label: 'å’¨è¯¢äººæ•°',
                data: [],
                borderColor: 'rgb(99, 102, 241)',
                backgroundColor: 'rgba(99, 102, 241, 0.15)',
                fill: true,
                tension: 0.35,
                borderWidth: 2,
                pointRadius: 3,
                pointHoverRadius: 5,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: (context) => `å’¨è¯¢äººæ•°: ${context.parsed.y} äºº`,
                },
              },
            },
            scales: {
              x: {
                grid: { display: false },
                ticks: { color: '#94a3b8' },
              },
              y: {
                beginAtZero: true,
                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                ticks: {
                  color: '#94a3b8',
                  stepSize: 1,
                  precision: 0,
                  callback: (value) => `${Math.round(value)} äºº`,
                },
              },
            },
          },
        });

        // é¢„çº¦è½¬åŒ–è¶‹åŠ¿å›¾è¡¨ï¼ˆåŒè½´ï¼‰
        const bookingCtx = document.getElementById('bookingTrendChart').getContext('2d');
        bookingTrendChart = new Chart(bookingCtx, {
          type: 'line',
          data: {
            labels: [],
            datasets: [
              {
                label: 'é¢„çº¦æ¬¡æ•°',
                data: [],
                borderColor: 'rgb(168, 85, 247)',
                backgroundColor: 'rgba(168, 85, 247, 0.15)',
                fill: true,
                tension: 0.35,
                borderWidth: 2,
                pointRadius: 3,
                pointHoverRadius: 5,
                yAxisID: 'y',
              },
              {
                label: 'é¢„çº¦æˆåŠŸç‡',
                data: [],
                borderColor: 'rgb(16, 185, 129)',
                backgroundColor: 'rgba(16, 185, 129, 0.15)',
                fill: false,
                tension: 0.35,
                borderWidth: 2,
                pointRadius: 3,
                pointHoverRadius: 5,
                yAxisID: 'y1',
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: {
                  color: '#94a3b8',
                  usePointStyle: true,
                  padding: 15,
                },
              },
              tooltip: {
                callbacks: {
                  label: (context) => {
                    const label = context.dataset.label || '';
                    const value = context.parsed.y;
                    if (label.includes('æˆåŠŸç‡')) {
                      return `${label}: ${value.toFixed(1)}%`;
                    }
                    return `${label}: ${value} æ¬¡`;
                  },
                },
              },
            },
            scales: {
              x: {
                grid: { display: false },
                ticks: { color: '#94a3b8' },
              },
              y: {
                type: 'linear',
                display: true,
                position: 'left',
                beginAtZero: true,
                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                ticks: {
                  color: '#94a3b8',
                  stepSize: 1,
                  precision: 0,
                  callback: (value) => `${Math.round(value)} æ¬¡`,
                },
                title: {
                  display: true,
                  text: 'é¢„çº¦æ¬¡æ•°',
                  color: 'rgb(168, 85, 247)',
                },
              },
              y1: {
                type: 'linear',
                display: true,
                position: 'right',
                beginAtZero: true,
                max: 100,
                grid: { drawOnChartArea: false },
                ticks: {
                  color: '#94a3b8',
                  callback: (value) => `${value}%`,
                },
                title: {
                  display: true,
                  text: 'æˆåŠŸç‡ (%)',
                  color: 'rgb(16, 185, 129)',
                },
              },
            },
          },
        });
      }

      function updateCharts(data) {
        const isToday = currentTimeRange === 'today';
        const formatLabel = isToday ? formatMinuteLabel : formatDayLabel;

        // æœ¬æ—¥ï¼šæ˜¾ç¤ºæœ€è¿‘90ä¸ªæ•°æ®ç‚¹ï¼›æœ¬å‘¨/æœ¬æœˆï¼šæ˜¾ç¤ºå…¨éƒ¨æ•°æ®ç‚¹
        const responsePoints = isToday
          ? (data.responseTrend || []).slice(-90)
          : (data.responseTrend || []);
        const responseLabels = responsePoints.map((point) => formatLabel(point.minute));
        responseTrendChart.data.labels = responseLabels;
        responseTrendChart.data.datasets[0].data = responsePoints.map((point) =>
          point.avgDuration ? point.avgDuration / 1000 : 0,
        );
        responseTrendChart.update();

        // æ›´æ–°å›¾è¡¨èŒƒå›´æ ‡ç­¾
        const rangeText = isToday
          ? `${responseLabels.length} åˆ†é’Ÿ`
          : `${responseLabels.length} å¤©`;
        document.getElementById('chartRangeLabel').textContent = responseLabels.length;
        document.getElementById('responseChartAvg').textContent =
          responsePoints.length > 0
            ? formatDuration(responsePoints[responsePoints.length - 1].avgDuration)
            : '-';

        const alertPoints = isToday
          ? (data.alertTrend || []).slice(-90)
          : (data.alertTrend || []);
        const alertLabels = alertPoints.map((point) => formatLabel(point.minute));
        alertTrendChart.data.labels = alertLabels;
        alertTrendChart.data.datasets[0].data = alertPoints.map((point) => point.count);
        alertTrendChart.update();
        const lastFiveAlerts = alertPoints.slice(-5).reduce((sum, point) => sum + point.count, 0);
        document.getElementById('alertTrendRecent').textContent = lastFiveAlerts || 0;

        // æ›´æ–°ä¸šåŠ¡æŒ‡æ ‡è¶‹åŠ¿å›¾è¡¨
        const businessPoints = isToday
          ? (data.businessTrend || []).slice(-90)
          : (data.businessTrend || []);
        const businessLabels = businessPoints.map((point) => formatLabel(point.minute));

        // å’¨è¯¢äººæ•°è¶‹åŠ¿
        consultationsTrendChart.data.labels = businessLabels;
        consultationsTrendChart.data.datasets[0].data = businessPoints.map(
          (point) => point.consultations,
        );
        consultationsTrendChart.update();

        // é¢„çº¦è½¬åŒ–è¶‹åŠ¿ï¼ˆåŒè½´ï¼šé¢„çº¦æ¬¡æ•° + æˆåŠŸç‡ï¼‰
        bookingTrendChart.data.labels = businessLabels;
        bookingTrendChart.data.datasets[0].data = businessPoints.map(
          (point) => point.bookingAttempts,
        );
        bookingTrendChart.data.datasets[1].data = businessPoints.map(
          (point) => point.bookingSuccessRate,
        );
        bookingTrendChart.update();
      }

      async function refreshHealthStatus() {
        try {
          const response = await fetch('/agent/health');
          const result = await response.json();
          const health = unwrapResponse(result);
          updateHealthCard(
            'overallHealthCard',
            'overallHealthStatus',
            'overallHealthMessage',
            health.status === 'healthy' ? 'success' : 'warning',
            health.status === 'healthy' ? 'è¿è¡Œæ­£å¸¸' : 'æœåŠ¡é™çº§',
            health.message || 'Agent æœåŠ¡çŠ¶æ€æœªçŸ¥',
          );

          updateHealthCard(
            'modelHealthCard',
            'modelHealthStatus',
            'modelHealthDetails',
            health.models?.status === 'available' ? 'success' : 'warning',
            health.models?.status === 'available' ? 'æœåŠ¡å¯ç”¨' : 'éœ€å…³æ³¨',
            health.models?.message || 'æ¨¡å‹çŠ¶æ€æ£€æŸ¥ä¸­',
          );

          updateHealthCard(
            'toolHealthCard',
            'toolHealthStatus',
            'toolHealthDetails',
            health.tools?.status === 'healthy' ? 'success' : 'warning',
            health.tools?.status === 'healthy' ? 'å“åº”æ­£å¸¸' : 'å“åº”ç¼“æ…¢',
            health.tools?.message || 'å·¥å…·é“¾æ£€æŸ¥ä¸­',
          );

        } catch (error) {
          console.error('è·å–å¥åº·çŠ¶æ€å¤±è´¥', error);
        }
      }

      function updateHealthCard(cardId, statusId, descId, state, statusText, desc) {
        const card = document.getElementById(cardId);
        const status = document.getElementById(statusId);
        const descEl = document.getElementById(descId);
        if (!card || !status || !descEl) return;
        card.dataset.state = state;
        status.textContent = statusText;
        descEl.textContent = desc;
      }

      async function clearData() {
        try {
          await fetch('/monitoring/clear', { method: 'POST' });
          await refreshDashboard();
        } catch (error) {
          console.error('æ¸…ç©ºæ•°æ®å¤±è´¥', error);
        }
      }

      function formatTime(timestamp) {
        if (!timestamp) return '-';
        const date = new Date(timestamp);
        return date.toLocaleString('zh-CN', { hour12: false });
      }

      function formatMinuteLabel(value) {
        if (!value) return '-';
        const date = new Date(value);
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        return `${hours}:${minutes}`;
      }

      function formatDayLabel(value) {
        if (!value) return '-';
        const date = new Date(value);
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${month}-${day}`;
      }

      function formatDuration(value, fractionDigits = 2) {
        if (value === undefined || value === null) return '-';
        const seconds = value / 1000;
        return `${seconds.toFixed(fractionDigits)} ç§’`;
      }
    </script>
  </body>
</html>
