<!DOCTYPE html>
<html>
<head>
  <title>WebSocket è¿æ¥æµ‹è¯•</title>
  <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
  <style>
    body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
    .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
    .success { background: #1e4620; border: 1px solid #4ec94b; }
    .error { background: #5a1d1d; border: 1px solid #f14c4c; }
    .log { background: #264f78; padding: 8px; margin: 5px 0; border-radius: 3px; font-size: 12px; }
    pre { margin: 0; }
  </style>
</head>
<body>
  <h1>WebSocket è¿æ¥æµ‹è¯• - /logs å‘½åç©ºé—´</h1>

  <div id="status"></div>
  <div id="logs"></div>

  <script>
    const statusEl = document.getElementById('status');
    const logsEl = document.getElementById('logs');

    function addLog(message, data) {
      const logDiv = document.createElement('div');
      logDiv.className = 'log';
      logDiv.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
      if (data) {
        logDiv.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
      }
      logsEl.appendChild(logDiv);
    }

    addLog('å¼€å§‹è¿æ¥åˆ° http://localhost:8080/logs ...');

    const socket = io('http://localhost:8080/logs', {
      transports: ['websocket', 'polling'],
      reconnection: true,
      reconnectionAttempts: 3,
      timeout: 10000,
    });

    socket.on('connect', () => {
      statusEl.className = 'status success';
      statusEl.innerHTML = 'âœ… WebSocket è¿æ¥æˆåŠŸï¼<br>Socket ID: ' + socket.id + '<br>Transport: ' + socket.io.engine.transport.name;
      addLog('è¿æ¥æˆåŠŸ', {
        socketId: socket.id,
        transport: socket.io.engine.transport.name
      });
    });

    socket.on('connect_error', (err) => {
      statusEl.className = 'status error';
      statusEl.innerHTML = 'âŒ è¿æ¥é”™è¯¯: ' + err.message;
      addLog('è¿æ¥é”™è¯¯', { message: err.message, stack: err.stack });
    });

    socket.on('disconnect', (reason) => {
      statusEl.className = 'status error';
      statusEl.innerHTML = 'ğŸ”Œ è¿æ¥æ–­å¼€: ' + reason;
      addLog('è¿æ¥æ–­å¼€', { reason });
    });

    socket.on('history', (history) => {
      addLog('æ”¶åˆ°å†å²æ—¥å¿—', { count: history.length, sample: history.slice(0, 3) });
    });

    socket.on('log', (entry) => {
      addLog('æ”¶åˆ°æ–°æ—¥å¿—', entry);
    });

    socket.on('error', (err) => {
      addLog('æœåŠ¡å™¨é”™è¯¯', err);
    });

    // 10ç§’åçš„çŠ¶æ€æ£€æŸ¥
    setTimeout(() => {
      if (!socket.connected) {
        statusEl.className = 'status error';
        statusEl.innerHTML = 'âŒ 10ç§’åä»æœªè¿æ¥';
        addLog('è¿æ¥è¶…æ—¶ - 10ç§’åä»æœªè¿æ¥');
      }
    }, 10000);
  </script>
</body>
</html>
